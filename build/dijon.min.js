var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)};System.register("dijon/interfaces",[],function(t,e){"use strict";e&&e.id;return{setters:[],execute:function(){}}}),System.register("dijon/mvc",["dijon/application"],function(t,e){"use strict";var i,n,o,a,r;e&&e.id;return{setters:[function(t){i=t}],execute:function(){n=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.modelName=e,this.app=i.Application.getInstance(),this.game=this.app.game,t&&this.setData(t),this.app.registerModel(this)}return t.prototype.onRegister=function(){},t.prototype.onRemoved=function(){},t.prototype.getKeyExists=function(t){return null!==this.game.cache.getJSON(t)},t.prototype.setData=function(t){return this.getKeyExists(t)?(this._data=this.game.cache.getJSON(t),this._data):(console.log("Model:: cannot set data from key "+t+". Is it in the Phaser cache?"),!1)},t.prototype.getData=function(){return this._data},t.prototype.destroy=function(){this.app.removeModel(this)},Object.defineProperty(t.prototype,"name",{get:function(){return this.modelName||t.MODEL_NAME},enumerable:!0,configurable:!0}),t.MODEL_NAME="Model",t}(),t("Model",n),o=function(t){function e(e){void 0===e&&(e=null),t.call(this,e),this._languages={},this._languages.en=this._data}return __extends(e,t),e.prototype.getCopy=function(t,e){return this.getCopyGroup(t)[e]},e.prototype.getCopyGroup=function(t){return this._data[t]},e.prototype.addLanguage=function(t,e){if(!this.getKeyExists(e))throw new Error("cannot add an alternate language from key "+e+". Is it in the Phaser cache?");this._languages[t]=this.game.cache.getJSON(e)},e.prototype.changeLanguage=function(t){if("undefined"==typeof this._languages[t])throw new Error("there is no language "+t);this._data=this._languages[t]},Object.defineProperty(e.prototype,"name",{get:function(){return e.MODEL_NAME},enumerable:!0,configurable:!0}),e.MODEL_NAME="copyModel",e}(n),t("CopyModel",o),a=function(){function t(t,e,n){void 0===t&&(t=null),void 0===e&&(e=!0),void 0===n&&(n=null),this._viewComponent=t,this.mediatorName=null,this.app=i.Application.getInstance(),this.game=this.app.game,this.mediatorName=n,e&&this.register()}return t.prototype.register=function(){this.app.registerMediator(this)},t.prototype.remove=function(){this.app.removeMediator(this)},t.prototype.onRegister=function(){},t.prototype.onRemoved=function(){},t.prototype.destroy=function(){this.remove()},t.prototype.listNotificationInterests=function(){return[]},t.prototype.handleNotification=function(t){},t.prototype.sendNotification=function(t,e){this.app.sendNotification(t,e)},Object.defineProperty(t.prototype,"viewComponent",{get:function(){return this._viewComponent},set:function(t){this._viewComponent=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.mediatorName||t.MEDIATOR_NAME},enumerable:!0,configurable:!0}),t.MEDIATOR_NAME="Mediator",t}(),t("Mediator",a),r=function(){function t(t,e){void 0===e&&(e=null),this._name=t,this._body=e}return t.prototype.getName=function(){return this._name},t.prototype.setBody=function(t){this._body=t},t.prototype.getBody=function(){return this._body},t.prototype.destroy=function(){this._body=null,this._name=null},t}(),t("Notification",r)}}}),System.register("dijon/spine/spine",[],function(t,e){"use strict";function i(t,e,i){var n=t[e];switch(typeof n){case"string":return"true"===n?!0:!1;case"boolean":return n;default:return i||!1}}function n(t,e,i,n){("boolean"!=typeof n||i!==n)&&(t[e]=i)}function o(t,e,i){var n=t[e];switch(typeof n){case"string":return parseFloat(n);case"number":return n;default:return i||0}}function a(t,e,i,n){("number"!=typeof n||i!==n)&&(t[e]=i)}function r(t,e,i){var n=t[e];switch(typeof n){case"string":return parseInt(n,10);case"number":return 0|n;default:return i||0}}function s(t,e,i,n){("number"!=typeof n||i!==n)&&(t[e]=i)}function h(t,e,i){var n=t[e];switch(typeof n){case"string":return n;default:return i||""}}function u(t,e,i,n){("string"!=typeof n||i!==n)&&(t[e]=i)}function l(t,e,i,n){var o=10,a=1/o,r=a*a,s=r*a,h=3*a,u=3*r,l=6*r,c=6*s,d=2*-t+i,p=2*-e+n,f=3*(t-i)+1,_=3*(e-n)+1,m=t*h+d*u+f*s,g=e*h+p*u+_*s,y=d*l+f*c,v=p*l+_*c,x=f*c,b=_*c;return function(t){for(var e=m,i=g,n=y,a=v,r=x,s=b,h=e,u=i,l=o-2;;){if(h>=t){var c=h-e,d=u-i;return d+(u-d)*(t-c)/(h-c)}if(0===l)break;l--,e+=n,i+=a,n+=r,a+=s,h+=e,u+=i}return u+(1-u)*(t-h)/(1-h)}}function c(t,e,i){return i>e?e>t?i-(e-t)%(i-e):e+(t-e)%(i-e):e===i?e:t}function d(t,e,i){return t+(e-t)*i}function p(t){return 0>=t?(t-Math.PI)%(2*Math.PI)+Math.PI:(t+Math.PI)%(2*Math.PI)-Math.PI}function f(t,e,i){return p(t+p(e-t)*i)}var _,m,g,y,v,x,b,k,w,A,T,E,S,P,M,O,C,I,R,L,B,D,N,F,j,U,G,V,K,H,X,W,Y,z,J,q,$,Q,Z,tt,et,it;e&&e.id;return t("loadBool",i),t("saveBool",n),t("loadFloat",o),t("saveFloat",a),t("loadInt",r),t("saveInt",s),t("loadString",h),t("saveString",u),t("StepBezierCurve",l),t("wrap",c),t("tween",d),t("wrapAngleRadians",p),t("tweenAngle",f),{setters:[],execute:function(){_=function(){function t(){this.r=1,this.g=1,this.b=1,this.a=1}return t.prototype.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.load=function(t){var e=this,i=4294967295;switch(typeof t){case"string":i=parseInt(t,16);break;case"number":i=0|t;break;default:i=4294967295}return e.r=(i>>24&255)/255,e.g=(i>>16&255)/255,e.b=(i>>8&255)/255,e.a=(255&i)/255,e},t.prototype.toString=function(){var t=this;return"rgba("+(255*t.r).toFixed(0)+","+(255*t.g).toFixed(0)+","+(255*t.b).toFixed(0)+","+t.a+")"},t}(),t("Color",_),m=function(){function t(){this.evaluate=function(t){return t}}return t.prototype.load=function(t){if(this.evaluate=function(t){return t},"string"==typeof t&&"stepped"===t)this.evaluate=function(t){return 0};else if("object"==typeof t&&"number"==typeof t.length&&4===t.length){var e=o(t,0,0),i=o(t,1,0),n=o(t,2,1),a=o(t,3,1);this.evaluate=l(e,i,n,a)}return this},t}(),t("Curve",m),g=function(){function t(t){this.rad=0,this.rad=t||0}return Object.defineProperty(t.prototype,"deg",{get:function(){return 180*this.rad/Math.PI},set:function(t){this.rad=t*Math.PI/180},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cos",{get:function(){return Math.cos(this.rad)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sin",{get:function(){return Math.sin(this.rad)},enumerable:!0,configurable:!0}),t.prototype.selfIdentity=function(){return this.rad=0,this},t.prototype.copy=function(t){return this.rad=t.rad,this},t}(),t("Angle",g),y=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.equal=function(t,e,i){return void 0===i&&(i=1e-6),Math.abs(t.x-e.x)>i?!1:Math.abs(t.y-e.y)>i?!1:!0},t.add=function(e,i,n){return void 0===n&&(n=new t),n.x=e.x+i.x,n.y=e.y+i.y,n},t.prototype.add=function(e,i){return void 0===i&&(i=new t),t.add(this,e,i)},t.prototype.selfAdd=function(t){return this.x+=t.x,this.y+=t.y,this},t.tween=function(e,i,n,o){return void 0===o&&(o=new t),o.x=d(e.x,i.x,n),o.y=d(e.y,i.y,n),o},t.prototype.tween=function(e,i,n){return void 0===n&&(n=new t),t.tween(this,e,i,n)},t.prototype.selfTween=function(e,i){return t.tween(this,e,i,this)},t}(),t("Vector",y),v=function(t){function e(){t.call(this,0,0)}return __extends(e,t),e}(y),t("Position",v),x=function(t){function e(){t.call(this,0)}return __extends(e,t),e}(g),t("Rotation",x),b=function(t){function e(){t.call(this,1,1)}return __extends(e,t),e.prototype.selfIdentity=function(){return this.x=1,this.y=1,this},e}(y),t("Scale",b),k=function(){function t(){this.position=new v,this.rotation=new x,this.scale=new b}return t.prototype.copy=function(t){return this.position.copy(t.position),this.rotation.copy(t.rotation),this.scale.copy(t.scale),this},t.prototype.load=function(t){return this.position.x=o(t,"x",0),this.position.y=o(t,"y",0),this.rotation.deg=o(t,"rotation",0),this.scale.x=o(t,"scaleX",1),this.scale.y=o(t,"scaleY",1),this},t.equal=function(t,e,i){return void 0===i&&(i=1e-6),Math.abs(t.position.x-e.position.x)>i?!1:Math.abs(t.position.y-e.position.y)>i?!1:Math.abs(t.rotation.rad-e.rotation.rad)>i?!1:Math.abs(t.scale.x-e.scale.x)>i?!1:Math.abs(t.scale.y-e.scale.y)>i?!1:!0},t.identity=function(e){return void 0===e&&(e=new t),e.position.x=0,e.position.y=0,e.rotation.rad=0,e.scale.x=1,e.scale.y=1,e},t.translate=function(t,e,i){e*=t.scale.x,i*=t.scale.y;var n=t.rotation.rad,o=Math.cos(n),a=Math.sin(n),r=o*e-a*i,s=a*e+o*i;return t.position.x+=r,t.position.y+=s,t},t.rotate=function(t,e){return t.rotation.rad+=e,t.rotation.rad=p(t.rotation.rad),t},t.scale=function(t,e,i){return t.scale.x*=e,t.scale.y*=i,t},t.invert=function(e,i){void 0===i&&(i=new t);var n=1/e.scale.x,o=1/e.scale.y,a=-e.rotation.rad,r=-e.position.x,s=-e.position.y;i.scale.x=n,i.scale.y=o,i.rotation.rad=a;var h=r,u=s,l=a,c=Math.cos(l),d=Math.sin(l),p=c*h-d*u,f=d*h+c*u;return i.position.x=p*n,i.position.y=f*o,i},t.combine=function(e,i,n){void 0===n&&(n=new t);var o=i.position.x*e.scale.x,a=i.position.y*e.scale.y,r=e.rotation.rad,s=Math.cos(r),h=Math.sin(r),u=s*o-h*a,l=h*o+s*a;return n.position.x=u+e.position.x,n.position.y=l+e.position.y,n.rotation.rad=p(i.rotation.rad+e.rotation.rad),n.scale.x=i.scale.x*e.scale.x,n.scale.y=i.scale.y*e.scale.y,n},t.extract=function(e,i,n){void 0===n&&(n=new t),n.scale.x=e.scale.x/i.scale.x,n.scale.y=e.scale.y/i.scale.y,n.rotation.rad=p(e.rotation.rad-i.rotation.rad);var o=e.position.x-i.position.x,a=e.position.y-i.position.y,r=-i.rotation.rad,s=Math.cos(r),h=Math.sin(r),u=s*o-h*a,l=h*o+s*a;return n.position.x=u/i.scale.x,n.position.y=l/i.scale.y,n},t.transform=function(t,e,i){void 0===i&&(i=new y);var n=e.x*t.scale.x,o=e.y*t.scale.y,a=t.rotation.rad,r=Math.cos(a),s=Math.sin(a),h=r*n-s*o,u=s*n+r*o;return i.x=h+t.position.x,i.y=u+t.position.y,i},t.untransform=function(t,e,i){void 0===i&&(i=new y);var n=e.x-t.position.x,o=e.y-t.position.y,a=-t.rotation.rad,r=Math.cos(a),s=Math.sin(a),h=r*n-s*o,u=s*n+r*o;return i.x=h/t.scale.x,i.y=u/t.scale.y,i},t.tween=function(e,i,n,o){return void 0===o&&(o=new t),o.position.x=d(e.position.x,i.position.x,n),o.position.y=d(e.position.y,i.position.y,n),o.rotation.rad=f(e.rotation.rad,i.rotation.rad,n),o.scale.x=d(e.scale.x,i.scale.x,n),o.scale.y=d(e.scale.y,i.scale.y,n),o},t}(),t("Space",k),w=function(){function t(){this.parent_key="",this.length=0,this.local_space=new k,this.world_space=new k,this.inherit_rotation=!0,this.inherit_scale=!0}return t.prototype.copy=function(t){return this.parent_key=t.parent_key,this.length=t.length,this.local_space.copy(t.local_space),this.world_space.copy(t.world_space),this.inherit_rotation=t.inherit_rotation,this.inherit_scale=t.inherit_scale,this},t.prototype.load=function(t){return this.parent_key=h(t,"parent",""),this.length=o(t,"length",0),this.local_space.load(t),this.world_space.copy(this.local_space),this.inherit_rotation=i(t,"inheritRotation",!0),this.inherit_scale=i(t,"inheritScale",!0),this},t.flatten=function(e,i){var n=i[e.parent_key];if(n){t.flatten(n,i);var o=n.world_space,a=e.local_space,r=e.world_space,s=a.position.x*o.scale.x,h=a.position.y*o.scale.y,u=o.rotation.rad,l=Math.cos(u),c=Math.sin(u),d=l*s-c*h,f=c*s+l*h;r.position.x=d+o.position.x,r.position.y=f+o.position.y,e.inherit_rotation?r.rotation.rad=p(a.rotation.rad+o.rotation.rad):r.rotation.rad=a.rotation.rad,e.inherit_scale?(r.scale.x=a.scale.x*o.scale.x,r.scale.y=a.scale.y*o.scale.y):(r.scale.x=a.scale.x,r.scale.y=a.scale.y)}else e.world_space.copy(e.local_space);return e},t}(),t("Bone",w),A=function(){function t(){this.name="",this.bone_keys=[],this.target_key="",this.mix=1,this.bend_positive=!0}return t.prototype.load=function(t){return this.name=h(t,"name",""),this.bone_keys=t.bones||[],this.target_key=h(t,"target",""),this.mix=o(t,"mix",1),this.bend_positive=i(t,"bendPositive",!0),this},t}(),t("Ikc",A),T=function(){function t(){this.bone_key="",this.color=new _,this.attachment_key="",this.blend="normal"}return t.prototype.copy=function(t){return this.bone_key=t.bone_key,this.color.copy(t.color),this.attachment_key=t.attachment_key,this.blend=t.blend,this},t.prototype.load=function(t){return this.bone_key=h(t,"bone",""),this.color.load(t.color),this.attachment_key=h(t,"attachment",""),this.blend=h(t,"blend","normal"),this},t}(),t("Slot",T),E=function(){function t(t){this.type="region",this.name="",this.path="",this.type=t}return t.prototype.load=function(t){var e=h(t,"type","region");if(e!==this.type)throw new Error;return this.name=h(t,"name",""),this.path=h(t,"path",""),this},t}(),t("Attachment",E),S=function(t){function e(){t.call(this,"region"),this.local_space=new k,this.width=0,this.height=0}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.local_space.load(e),this.width=o(e,"width",0),this.height=o(e,"height",0),this},e}(E),t("RegionAttachment",S),P=function(t){function e(){t.call(this,"boundingbox"),this.vertices=[]}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.vertices=e.vertices||[],this},e}(E),t("BoundingBoxAttachment",P),M=function(t){function e(){t.call(this,"mesh"),this.color=new _,this.triangles=[],this.edges=[],this.vertices=[],this.uvs=[],this.hull=0}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.color.load(e.color),this.triangles=e.triangles||[],this.edges=e.edges||[],this.vertices=e.vertices||[],this.uvs=e.uvs||[],this.hull=r(e,"hull",0),this},e}(E),t("MeshAttachment",M),O=function(t){function e(){t.call(this,"skinnedmesh"),this.color=new _,this.triangles=[],this.edges=[],this.vertices=[],this.uvs=[],this.hull=0}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.color.load(e.color),this.triangles=e.triangles||[],this.edges=e.edges||[],this.vertices=e.vertices||[],this.uvs=e.uvs||[],this.hull=r(e,"hull",0),this},e}(E),t("SkinnedMeshAttachment",O),C=function(){function t(){this.attachments={},this.attachment_keys=[]}return t.prototype.load=function(t){var e=this;return this.attachment_keys=Object.keys(t),this.attachment_keys.forEach(function(i){var n=t[i];switch(n.type){case"region":default:e.attachments[i]=(new S).load(n);break;case"boundingbox":e.attachments[i]=(new P).load(n);break;case"mesh":e.attachments[i]=(new M).load(n);break;case"skinnedmesh":e.attachments[i]=(new O).load(n)}}),this},t}(),t("SkinSlot",C),I=function(){function t(){this.name="",this.slots={},this.slot_keys=[]}return t.prototype.load=function(t){var e=this;return this.name=h(t,"name",""),this.slot_keys=Object.keys(t),this.slot_keys.forEach(function(i){e.slots[i]=(new C).load(t[i])}),this},t.prototype.iterateAttachments=function(t){var e=this;this.slot_keys.forEach(function(i){var n=e.slots[i];n.attachment_keys.forEach(function(e){var o=n.attachments[e];t(i,n,o.path||o.name||e,o)})})},t}(),t("Skin",I),R=function(){function t(){this.name="",this.int_value=0,this.float_value=0,this.string_value=""}return t.prototype.copy=function(t){return this.name=t.name,this.int_value=t.int_value,this.float_value=t.float_value,this.string_value=t.string_value,this},t.prototype.load=function(t){return this.name=h(t,"name",""),"number"==typeof t["int"]&&(this.int_value=r(t,"int",0)),"number"==typeof t["float"]&&(this.float_value=o(t,"float",0)),"string"==typeof t.string&&(this.string_value=h(t,"string","")),this},t}(),t("Event",R),L=function(){function t(){this.time=0}return t.prototype.drop=function(){return this.time=0,this},t.prototype.load=function(t){return this.time=1e3*o(t,"time",0),this},t.prototype.save=function(t){return a(t,"time",this.time/1e3,0),this},t.find=function(t,e){if(!t)return-1;if(t.length<=0)return-1;if(e<t[0].time)return-1;var i=t.length-1;if(e>=t[i].time)return i;var n=0,o=i;if(0===o)return 0;for(var a=o>>1;;){if(t[a+1].time<=e?n=a+1:o=a,n===o)return n;a=n+o>>1}},t.compare=function(t,e){return t.time-e.time},t}(),t("Keyframe",L),B=function(t){function e(){t.apply(this,arguments),this.curve=new m}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.curve.load(e.curve),this},e}(L),t("BoneKeyframe",B),D=function(t){function e(){t.apply(this,arguments),this.position=new v}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.position.x=o(e,"x",0),this.position.y=o(e,"y",0),this},e}(B),t("TranslateKeyframe",D),N=function(t){function e(){t.apply(this,arguments),this.rotation=new x}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.rotation.deg=o(e,"angle",0),this},e}(B),t("RotateKeyframe",N),F=function(t){function e(){t.apply(this,arguments),this.scale=new b}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.scale.x=o(e,"x",1),this.scale.y=o(e,"y",1),this},e}(B),t("ScaleKeyframe",F),j=function(){function t(){this.min_time=0,this.max_time=0}return t.prototype.load=function(t){var e=this;return this.min_time=0,this.max_time=0,this.translate_keyframes=null,this.rotate_keyframes=null,this.scale_keyframes=null,Object.keys(t).forEach(function(i){switch(i){case"translate":e.translate_keyframes=[],t.translate.forEach(function(t){var i=(new D).load(t);e.translate_keyframes.push(i),e.min_time=Math.min(e.min_time,i.time),e.max_time=Math.max(e.max_time,i.time)}),e.translate_keyframes.sort(L.compare);break;case"rotate":e.rotate_keyframes=[],t.rotate.forEach(function(t){var i=(new N).load(t);e.rotate_keyframes.push(i),e.min_time=Math.min(e.min_time,i.time),e.max_time=Math.max(e.max_time,i.time)}),e.rotate_keyframes.sort(L.compare);break;case"scale":e.scale_keyframes=[],t.scale.forEach(function(t){var i=(new F).load(t);e.scale_keyframes.push(i),e.min_time=Math.min(e.min_time,i.time),e.max_time=Math.max(e.max_time,i.time)}),e.scale_keyframes.sort(L.compare);break;default:console.log("TODO: AnimBone::load",i)}}),this},t}(),t("AnimBone",j),U=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(L),t("SlotKeyframe",U),G=function(t){function e(){t.apply(this,arguments),this.color=new _,this.curve=new m}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.color.load(e.color),this.curve.load(e.curve),this},e}(U),t("ColorKeyframe",G),V=function(t){function e(){t.apply(this,arguments),this.name=""}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.name=h(e,"name",""),this},e}(U),t("AttachmentKeyframe",V),K=function(){function t(){this.min_time=0,this.max_time=0}return t.prototype.load=function(t){var e=this;return this.min_time=0,this.max_time=0,this.color_keyframes=null,this.attachment_keyframes=null,Object.keys(t).forEach(function(i){switch(i){case"color":e.color_keyframes=[],t[i].forEach(function(t){var i=(new G).load(t);e.min_time=Math.min(e.min_time,i.time),e.max_time=Math.max(e.max_time,i.time),e.color_keyframes.push(i)}),e.color_keyframes.sort(L.compare);break;case"attachment":e.attachment_keyframes=[],t[i].forEach(function(t){var i=(new V).load(t);e.min_time=Math.min(e.min_time,i.time),e.max_time=Math.max(e.max_time,i.time),e.attachment_keyframes.push(i)}),e.attachment_keyframes.sort(L.compare);break;default:console.log("TODO: AnimSlot::load",i)}}),this},t}(),t("AnimSlot",K),H=function(t){function e(){t.apply(this,arguments),this.name="",this.int_value=0,this.float_value=0,this.string_value=""}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.name=h(e,"name",""),"number"==typeof e["int"]&&(this.int_value=r(e,"int",0)),"number"==typeof e["float"]&&(this.float_value=o(e,"float",0)),"string"==typeof e.string&&(this.string_value=h(e,"string","")),this},e}(L),t("EventKeyframe",H),X=function(){function t(){this.slot_key="",this.offset=0}return t.prototype.load=function(t){return this.slot_key=h(t,"slot",""),this.offset=r(t,"offset",0),this},t}(),t("SlotOffset",X),W=function(t){function e(){t.apply(this,arguments),this.slot_offsets=[]}return __extends(e,t),e.prototype.load=function(e){var i=this;return t.prototype.load.call(this,e),this.slot_offsets=[],Object.keys(e).forEach(function(t){switch(t){case"offsets":e[t].forEach(function(t){i.slot_offsets.push((new X).load(t))})}}),this},e}(L),t("OrderKeyframe",W),Y=function(t){function e(){t.apply(this,arguments),this.curve=new m,this.mix=1,this.bend_positive=!0}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.curve.load(e),this.mix=o(e,"mix",1),this.bend_positive=i(e,"bendPositive",!0),this},e}(L),t("IkcKeyframe",Y),z=function(){function t(){this.min_time=0,this.max_time=0}return t.prototype.load=function(t){var e=this;return this.min_time=0,this.max_time=0,this.ikc_keyframes=[],t.forEach(function(t){var i=(new Y).load(t);e.min_time=Math.min(e.min_time,i.time),e.max_time=Math.max(e.max_time,i.time),e.ikc_keyframes.push(i)}),this.ikc_keyframes.sort(L.compare),this},t}(),t("AnimIkc",z),J=function(t){function e(){t.apply(this,arguments),this.curve=new m,this.offset=0}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.curve.load(e),this.offset=r(e,"offset",0),this.vertices=e.vertices||[],this},e}(L),t("FfdKeyframe",J),q=function(){function t(){this.min_time=0,this.max_time=0}return t.prototype.load=function(t){var e=this;return this.min_time=0,this.max_time=0,this.ffd_keyframes=[],t.forEach(function(t){var i=(new J).load(t);e.min_time=Math.min(e.min_time,i.time),e.max_time=Math.max(e.max_time,i.time),e.ffd_keyframes.push(i)}),this.ffd_keyframes.sort(L.compare),this},t}(),t("FfdAttachment",q),$=function(){function t(){}return t.prototype.load=function(t){var e=this;return this.ffd_attachments={},this.ffd_attachment_keys=Object.keys(t),this.ffd_attachment_keys.forEach(function(i){e.ffd_attachments[i]=(new q).load(t[i])}),this},t.prototype.iterateAttachments=function(t){var e=this;this.ffd_attachment_keys.forEach(function(i){var n=e.ffd_attachments[i];t(i,n)})},t}(),t("FfdSlot",$),Q=function(){function t(){this.min_time=0,this.max_time=0}return t.prototype.load=function(t){var e=this;return this.min_time=0,this.max_time=0,this.ffd_slots={},this.ffd_slot_keys=Object.keys(t),this.ffd_slot_keys.forEach(function(i){e.ffd_slots[i]=(new $).load(t[i])}),this.iterateAttachments(function(t,i,n,o){e.min_time=Math.min(e.min_time,o.min_time),e.max_time=Math.max(e.max_time,o.max_time)}),this},t.prototype.iterateAttachments=function(t){var e,i=this;this.ffd_slot_keys.forEach(function(n){e=i.ffd_slots[n],e.iterateAttachments(function(i,o){t(n,e,i,o)})})},t}(),t("AnimFfd",Q),Z=function(){function t(){this.name="",this.min_time=0,this.max_time=0,this.length=0}return t.prototype.load=function(t){var e=this;return this.bones={},this.slots={},this.event_keyframes=null,this.order_keyframes=null,this.ikcs={},this.ffds={},this.min_time=0,this.max_time=0,Object.keys(t).forEach(function(i){switch(i){case"bones":Object.keys(t[i]).forEach(function(n){var o=(new j).load(t[i][n]);e.min_time=Math.min(e.min_time,o.min_time),e.max_time=Math.max(e.max_time,o.max_time),e.bones[n]=o});break;case"slots":Object.keys(t[i]).forEach(function(n){var o=(new K).load(t[i][n]);e.min_time=Math.min(e.min_time,o.min_time),e.max_time=Math.max(e.max_time,o.max_time),e.slots[n]=o});break;case"events":e.event_keyframes=[],t[i].forEach(function(t){var i=(new H).load(t);e.min_time=Math.min(e.min_time,i.time),e.max_time=Math.max(e.max_time,i.time),e.event_keyframes.push(i)}),e.event_keyframes.sort(L.compare);break;case"drawOrder":case"draworder":e.order_keyframes=[],t[i].forEach(function(t){var i=(new W).load(t);e.min_time=Math.min(e.min_time,i.time),e.max_time=Math.max(e.max_time,i.time),e.order_keyframes.push(i)}),e.order_keyframes.sort(L.compare);break;case"ik":Object.keys(t[i]).forEach(function(n){var o=(new z).load(t[i][n]);e.min_time=Math.min(e.min_time,o.min_time),e.max_time=Math.max(e.max_time,o.max_time),e.ikcs[n]=o});break;case"ffd":Object.keys(t[i]).forEach(function(n){var o=(new Q).load(t[i][n]);e.min_time=Math.min(e.min_time,o.min_time),e.max_time=Math.max(e.max_time,o.max_time),e.ffds[n]=o});break;default:console.log("TODO: Animation::load",i)}}),this.length=this.max_time-this.min_time,this},t}(),t("Animation",Z),tt=function(){function t(){this.hash="",this.spine="",this.width=0,this.height=0,this.images=""}return t.prototype.load=function(t){return this.hash=h(t,"hash",""),this.spine=h(t,"spine",""),this.width=r(t,"width",0),this.height=r(t,"height",0),this.images=h(t,"images",""),this},t}(),t("Skeleton",tt),et=function(){function t(){this.name="",this.skeleton=new tt,this.bones={},this.bone_keys=[],this.ikcs={},this.ikc_keys=[],this.slots={},this.slot_keys=[],this.skins={},this.skin_keys=[],this.events={},this.event_keys=[],this.anims={},this.anim_keys=[]}return t.prototype.load=function(t){var e=this;return this.bones={},this.bone_keys=[],this.ikcs={},this.ikc_keys=[],this.slots={},this.slot_keys=[],this.skins={},this.skin_keys=[],this.events={},this.event_keys=[],this.anims={},this.anim_keys=[],Object.keys(t).forEach(function(i){switch(i){case"skeleton":e.skeleton.load(t[i]);break;case"bones":var n=t[i];n.forEach(function(t,i){e.bones[t.name]=(new w).load(t),e.bone_keys[i]=t.name});break;case"ik":var o=t[i];o.forEach(function(t,i){e.ikcs[t.name]=(new A).load(t),e.ikc_keys[i]=t.name});break;case"slots":var a=t[i];a.forEach(function(t,i){e.slots[t.name]=(new T).load(t),e.slot_keys[i]=t.name});break;case"skins":var r=t[i];e.skin_keys=Object.keys(r),e.skin_keys.forEach(function(t){var i=e.skins[t]=(new I).load(r[t]);i.name=i.name||t});break;case"events":var s=t[i];e.event_keys=Object.keys(s),e.event_keys.forEach(function(t){var i=e.events[t]=(new R).load(s[t]);i.name=i.name||t});break;case"animations":var h=t[i];e.anim_keys=Object.keys(h),e.anim_keys.forEach(function(t){var i=e.anims[t]=(new Z).load(h[t]);i.name=i.name||t});break;default:console.log("TODO: Skeleton::load",i)}}),this.iterateBones(function(t,i){w.flatten(i,e.bones)}),this},t.prototype.loadSkeleton=function(t){return this.skeleton.load(t),this},t.prototype.loadEvent=function(t,e){var i=this.events[t]=(new R).load(e);return i.name=i.name||t,this},t.prototype.loadAnimation=function(t,e){var i=this.anims[t]=(new Z).load(e);return i.name=i.name||t,this},t.prototype.getSkins=function(){return this.skins},t.prototype.getEvents=function(){return this.events},t.prototype.getAnims=function(){return this.anims},t.prototype.iterateBones=function(t){var e=this;this.bone_keys.forEach(function(i){var n=e.bones[i];t(i,n)})},t.prototype.iterateAttachments=function(t,e){var i=this,n=this.skins[t],o=this.skins["default"];this.slot_keys.forEach(function(t){var a=i.slots[t],r=n&&(n.slots[t]||o.slots[t]),s=r&&r.attachments[a.attachment_key],h=s&&(s.path||s.name)||a.attachment_key;e(t,a,r,h,s)})},t.prototype.iterateSkins=function(t){var e=this;this.skin_keys.forEach(function(i){var n=e.skins[i];t(i,n)})},t.prototype.iterateEvents=function(t){var e=this;this.event_keys.forEach(function(i){var n=e.events[i];t(i,n)})},t.prototype.iterateAnims=function(t){var e=this;this.anim_keys.forEach(function(i){var n=e.anims[i];t(i,n)})},t}(),t("Data",et),it=function(){function t(t){this.skin_key="",this.anim_key="",this.time=0,this.elapsed_time=0,this.dirty=!0,this.bones={},this.bone_keys=[],this.slots={},this.slot_keys=[],this.events=[],this.onComplete=new Phaser.Signal,this.data=t}return t.prototype.curSkel=function(){var t=this,e=t.data;return e&&e.skeleton},t.prototype.getSkins=function(){var t=this,e=t.data;return e&&e.skins},t.prototype.curSkin=function(){var t=this,e=t.data;return e&&e.skins[t.skin_key]},t.prototype.getSkin=function(){var t=this;return t.skin_key},t.prototype.setSkin=function(t){var e=this;e.skin_key!==t&&(e.skin_key=t)},t.prototype.getEvents=function(){var t=this,e=t.data;return e&&e.events},t.prototype.getAnims=function(){var t=this,e=t.data;return e&&e.anims},t.prototype.curAnim=function(){var t=this,e=t.data;return e&&e.anims[t.anim_key]},t.prototype.curAnimLength=function(){var t=this,e=t.data,i=e&&e.anims[t.anim_key];return i&&i.length||0},t.prototype.getAnim=function(){var t=this;return t.anim_key},t.prototype.setAnim=function(t){var e=this;if(e.anim_key!==t){e.anim_key=t;var i=e.data,n=i&&i.anims[e.anim_key];n&&(e.time=c(e.time,n.min_time,n.max_time)),e.elapsed_time=0,e.dirty=!0}},t.prototype.getTime=function(){var t=this;return t.time},t.prototype.setTime=function(t){var e=this,i=e.data,n=i&&i.anims[e.anim_key];n&&(t=c(t,n.min_time,n.max_time)),e.time!==t&&(e.time=t,e.elapsed_time=0,e.dirty=!0)},t.prototype.update=function(t){var e=this;e.elapsed_time+=t,e.dirty=!0},t.prototype.strike=function(){var t=this;if(t.dirty){t.dirty=!1;var e=t.data,i=e&&e.anims[t.anim_key],n=t.time,o=t.elapsed_time;t.time=t.time+t.elapsed_time,t.elapsed_time=0;var a=!1,r=!1;i&&(a=0>o&&t.time<=i.min_time,r=o>0&&t.time>=i.max_time,r&&this.onComplete.dispatch(),t.time=c(t.time,i.min_time,i.max_time));var s,h=t.time;if(e.bone_keys.forEach(function(n){var o=e.bones[n],a=t.bones[n]||(t.bones[n]=new w);a.copy(o);var r=i&&i.bones[n];if(r){if(s=L.find(r.translate_keyframes,h),-1!==s){var u=r.translate_keyframes[s],l=r.translate_keyframes[s+1];if(l){var c=u.curve.evaluate((h-u.time)/(l.time-u.time));a.local_space.position.x+=d(u.position.x,l.position.x,c),a.local_space.position.y+=d(u.position.y,l.position.y,c)}else a.local_space.position.x+=u.position.x,a.local_space.position.y+=u.position.y}if(s=L.find(r.rotate_keyframes,h),-1!==s){var p=r.rotate_keyframes[s],_=r.rotate_keyframes[s+1];if(_){var c=p.curve.evaluate((h-p.time)/(_.time-p.time));a.local_space.rotation.rad+=f(p.rotation.rad,_.rotation.rad,c)}else a.local_space.rotation.rad+=p.rotation.rad}if(s=L.find(r.scale_keyframes,h),-1!==s){var m=r.scale_keyframes[s],g=r.scale_keyframes[s+1];if(g){var c=m.curve.evaluate((h-m.time)/(g.time-m.time));a.local_space.scale.x+=d(m.scale.x,g.scale.x,c)-1,a.local_space.scale.y+=d(m.scale.y,g.scale.y,c)-1}else a.local_space.scale.x+=m.scale.x-1,a.local_space.scale.y+=m.scale.y-1}}}),t.bone_keys=e.bone_keys,e.ikc_keys.forEach(function(n){function o(t,e,i){return e>t?e:t>i?i:t}var a=e.ikcs[n],r=a.mix,u=a.bend_positive,l=i&&i.ikcs[n];if(l&&(s=L.find(l.ikc_keyframes,h),-1!==s)){var c=l.ikc_keyframes[s],p=l.ikc_keyframes[s+1];if(p){var _=c.curve.evaluate((h-c.time)/(p.time-c.time));r=d(c.mix,p.mix,_)}else r=c.mix;u=c.bend_positive}var m=t.bones[a.target_key];w.flatten(m,t.bones);var g=m.world_space.position.x,v=m.world_space.position.y,x=r,b=u?1:-1;if(0!==x)switch(a.bone_keys.length){case 1:var A=t.bones[a.bone_keys[0]];w.flatten(A,t.bones);var T=0,E=t.bones[A.parent_key];E&&A.inherit_rotation&&(w.flatten(E,t.bones),T=E.world_space.rotation.rad),g-=A.world_space.position.x,v-=A.world_space.position.y,A.local_space.rotation.rad=f(A.local_space.rotation.rad,Math.atan2(v,g)-T,x);break;case 2:var S=t.bones[a.bone_keys[0]];w.flatten(S,t.bones);var P=t.bones[a.bone_keys[1]];w.flatten(P,t.bones);var M=new y,O=t.bones[S.parent_key];O?(M.x=g,M.y=v,w.flatten(O,t.bones),k.untransform(O.world_space,M,M),g=(M.x-S.local_space.position.x)*O.world_space.scale.x,v=(M.y-S.local_space.position.y)*O.world_space.scale.y):(g-=S.local_space.position.x,v-=S.local_space.position.y),M.copy(P.local_space.position);var C=t.bones[P.parent_key];C!==S&&(w.flatten(C,t.bones),k.transform(C.world_space,M,M),k.untransform(S.world_space,M,M));var I=M.x*S.world_space.scale.x,R=M.y*S.world_space.scale.y,B=Math.atan2(R,I),D=Math.sqrt(I*I+R*R),N=P.length*P.world_space.scale.x,F=2*D*N;if(1e-4>F)return void(P.local_space.rotation.rad=f(P.local_space.rotation.rad,Math.atan2(v,g)-S.local_space.rotation.rad,x));var j=o((g*g+v*v-D*D-N*N)/F,-1,1),U=Math.acos(j)*b,G=Math.sin(U),V=N*j+D,K=N*G,H=Math.atan2(v*V-g*K,g*V+v*K);S.local_space.rotation.rad=f(S.local_space.rotation.rad,H-B,x);var X=U;C!==S&&(X+=S.world_space.rotation.rad-C.world_space.rotation.rad),
P.local_space.rotation.rad=f(P.local_space.rotation.rad,X+B,x)}}),t.iterateBones(function(e,i){w.flatten(i,t.bones)}),e.slot_keys.forEach(function(n){var o=e.slots[n],a=t.slots[n]||(t.slots[n]=new T);a.copy(o);var r=i&&i.slots[n];if(r){if(s=L.find(r.color_keyframes,h),-1!==s){var u=r.color_keyframes[s],l=r.color_keyframes[s+1];if(l){var c=u.curve.evaluate((h-u.time)/(l.time-u.time));a.color.r=d(u.color.r,l.color.r,c),a.color.g=d(u.color.g,l.color.g,c),a.color.b=d(u.color.b,l.color.b,c),a.color.a=d(u.color.a,l.color.a,c)}else a.color.r=u.color.r,a.color.g=u.color.g,a.color.b=u.color.b,a.color.a=u.color.a}if(s=L.find(r.attachment_keyframes,h),-1!==s){var p=r.attachment_keyframes[s];a.attachment_key=p.name}}}),t.slot_keys=e.slot_keys,i&&(s=L.find(i.order_keyframes,h),-1!==s)){var u=i.order_keyframes[s];t.slot_keys=e.slot_keys.slice(0),u.slot_offsets.forEach(function(e){var i=t.slot_keys.indexOf(e.slot_key);-1!==i&&(t.slot_keys.splice(i,1),t.slot_keys.splice(i+e.offset,0,e.slot_key))})}if(t.events.length=0,i&&i.event_keyframes){var l=function(i){var n=new R,o=e.events[i.name];o&&n.copy(o),n.int_value=i.int_value||n.int_value,n.float_value=i.float_value||n.float_value,n.string_value=i.string_value||n.string_value,t.events.push(n)};0>o?a?i.event_keyframes.forEach(function(t){(i.min_time<=t.time&&t.time<n||h<=t.time&&t.time<=i.max_time)&&l(t)}):i.event_keyframes.forEach(function(t){h<=t.time&&t.time<n&&l(t)}):r?i.event_keyframes.forEach(function(t){(i.min_time<=t.time&&t.time<=h||n<t.time&&t.time<=i.max_time)&&l(t)}):i.event_keyframes.forEach(function(t){n<t.time&&t.time<=h&&l(t)})}}},t.prototype.iterateBones=function(t){var e=this;e.bone_keys.forEach(function(i){var n=e.bones[i];t(i,n)})},t.prototype.iterateAttachments=function(t){var e=this,i=e.data,n=i&&i.skins[e.skin_key],o=i&&i.skins["default"];e.slot_keys.forEach(function(i){var a=e.slots[i],r=n&&(n.slots[i]||o.slots[i]),s=r&&r.attachments[a.attachment_key],h=s&&(s.path||s.name)||a.attachment_key;t(i,a,r,h,s)})},t}(),t("Pose",it)}}}),System.register("dijon/spine/atlas",[],function(t,e){"use strict";function i(t){return t.replace(/^\s+|\s+$/g,"")}var n,o,a;e&&e.id;return{setters:[],execute:function(){n=function(){function t(){this.name="",this.w=0,this.h=0,this.format="RGBA8888",this.min_filter="linear",this.mag_filter="linear",this.wrap_s="clamp-to-edge",this.wrap_t="clamp-to-edge"}return t}(),t("Page",n),o=function(){function t(){this.page=null,this.x=0,this.y=0,this.w=0,this.h=0,this.rotate=0,this.offset_x=0,this.offset_y=0,this.original_w=0,this.original_h=0,this.index=-1}return t}(),t("Site",o),a=function(){function t(){this.pages=[],this.sites={}}return t.prototype.drop=function(){var t=this;return t.pages=[],t.sites={},this},t.prototype["import"]=function(t){return this.importAtlasText(t)},t.prototype["export"]=function(t){return void 0===t&&(t=""),this.exportAtlasText(t)},t.prototype.importAtlasText=function(t){var e=t.split(/\n|\r\n/);return this.importAtlasTextLines(e)},t.prototype.exportAtlasText=function(t){void 0===t&&(t="");var e=this.exportAtlasTextLines([]);return t+e.join("\n")},t.prototype.importAtlasTextLines=function(t){var e=this;e.pages=[],e.sites={};var a=null,r=null,s=null;return t.forEach(function(t){if(0===i(t).length)a=null,r=null;else if(s=t.match(/^size: (.*),(.*)$/))a.w=parseInt(s[1],10),a.h=parseInt(s[2],10);else if(s=t.match(/^format: (.*)$/))a.format=s[1];else if(s=t.match(/^filter: (.*),(.*)$/))a.min_filter=s[1],a.mag_filter=s[2];else if(s=t.match(/^repeat: (.*)$/)){var h=s[1];a.wrap_s="x"===h||"xy"===h?"Repeat":"ClampToEdge",a.wrap_t="y"===h||"xy"===h?"Repeat":"ClampToEdge"}else if(s=t.match(/^orig: (.*)[,| x] (.*)$/)){var u=parseInt(s[1],10),l=parseInt(s[2],10);console.log("page:orig",u,l)}else null===a?(a=new n,a.name=t,e.pages.push(a)):(s=t.match(/^ {2}rotate: (.*)$/))?r.rotate="true"===s[1]?-1:0:(s=t.match(/^ {2}xy: (.*), (.*)$/))?(r.x=parseInt(s[1],10),r.y=parseInt(s[2],10)):(s=t.match(/^ {2}size: (.*), (.*)$/))?(r.w=parseInt(s[1],10),r.h=parseInt(s[2],10)):(s=t.match(/^ {2}orig: (.*), (.*)$/))?(r.original_w=parseInt(s[1],10),r.original_h=parseInt(s[2],10)):(s=t.match(/^ {2}offset: (.*), (.*)$/))?(r.offset_x=parseInt(s[1],10),r.offset_y=parseInt(s[2],10)):(s=t.match(/^ {2}index: (.*)$/))?r.index=parseInt(s[1],10):(r&&(r.original_w=r.original_w||r.w,r.original_h=r.original_h||r.h),r=new o,r.page=a,e.sites[t]=r)}),e},t.prototype.exportAtlasTextLines=function(t){void 0===t&&(t=[]);var e=this;return e.pages.forEach(function(i){t.push(""),t.push(i.name),t.push("size: "+i.w+","+i.h),t.push("format: "+i.format),t.push("filter: "+i.min_filter+","+i.mag_filter);var n="none";"Repeat"===i.wrap_s&&"Repeat"===i.wrap_t?n="xy":"Repeat"===i.wrap_s?n="x":"Repeat"===i.wrap_t&&(n="y"),t.push("repeat: "+n),Object.keys(e.sites).forEach(function(n){var o=e.sites[n];o.page===i&&(t.push(n),t.push("  rotate: "+(0===o.rotate?"false":"true")),t.push("  xy: "+o.x+", "+o.y),t.push("  size: "+o.w+", "+o.h),t.push("  orig: "+o.original_w+", "+o.original_h),t.push("  offset: "+o.offset_x+", "+o.offset_y),t.push("  index: "+o.index))})}),t},t.prototype.importTpsText=function(t){var e=this;return e.pages=[],e.sites={},e.importTpsTextPage(t,0)},t.prototype.importTpsTextPage=function(t,e){void 0===e&&(e=0);var i=this,a=JSON.parse(t),r=i.pages[e]=new n;return a.meta&&(r.w=a.meta.size.w,r.h=a.meta.size.h,r.name=a.meta.image),Object.keys(a.frames||{}).forEach(function(t){var e=a.frames[t],n=i.sites[t]=new o;n.page=r,n.x=e.frame.x,n.y=e.frame.y,n.w=e.frame.w,n.h=e.frame.h,n.rotate=e.rotated?1:0,n.offset_x=e.spriteSourceSize&&e.spriteSourceSize.x||0,n.offset_y=e.spriteSourceSize&&e.spriteSourceSize.y||0,n.original_w=e.sourceSize&&e.sourceSize.w||n.w,n.original_h=e.sourceSize&&e.sourceSize.h||n.h}),i},t}(),t("Data",a)}}}),System.register("dijon/spine/render-webgl",["dijon/spine/spine"],function(t,e){"use strict";function i(t,e){for(var i=[],n=0;e>n;++n)i.push(t.replace(/{index}/g,n.toString()));return i}function n(t,e){return void 0===e&&(e=[]),t.forEach(function(t){Array.isArray(t)?n(t,e):e.push(t)}),e}function o(t){return t[0]=t[1]=t[2]=t[3]=1,t}function a(t,e){return t[0]=e.r,t[1]=e.g,t[2]=e.b,t[3]=e.a,t}function r(t,e){return t[0]*=e.r,t[1]*=e.g,t[2]*=e.b,t[3]*=e.a,t}function s(t){return t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0,t[0]=t[4]=t[8]=1,t}function h(t,e){return t.set(e),t}function u(t,e,i,n,o){var a=1/(e-i),r=1/(n-o);return t[0]*=-2*a,t[4]*=-2*r,t[6]+=(e+i)*a,t[7]+=(o+n)*r,t}function l(t,e,i){return t[6]+=t[0]*e+t[3]*i,t[7]+=t[1]*e+t[4]*i,t}function c(t,e,i){var n=t[0],o=t[1],a=t[3],r=t[4];return t[0]=n*e+a*i,t[1]=o*e+r*i,t[3]=a*e-n*i,t[4]=r*e-o*i,t}function d(t,e){return c(t,Math.cos(e),Math.sin(e))}function p(t,e,i){return t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=i,t[4]*=i,t[5]*=i,t}function f(t,e,i){var n=t[0]*e[0]+t[3]*e[1]+t[6],o=t[1]*e[0]+t[4]*e[1]+t[7],a=t[2]*e[0]+t[5]*e[1]+t[8],r=a?1/a:1;return i[0]=n*r,i[1]=o*r,i}function _(t,e){return e&&(l(t,e.position.x,e.position.y),d(t,e.rotation.rad),p(t,e.scale.x,e.scale.y)),t}function m(t,e){return e&&p(t,1/e.w,1/e.h),t}function g(t,e){return e&&(l(t,e.x,e.y),-1===e.rotate?(l(t,0,e.w),c(t,0,-1)):1===e.rotate&&(l(t,e.h,0),c(t,0,1)),p(t,e.w,e.h)),t}function y(t,e){return e&&(p(t,1/e.original_w,1/e.original_h),l(t,2*e.offset_x-(e.original_w-e.w),e.original_h-e.h-2*e.offset_y),p(t,e.w,e.h)),t}function v(t){return t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1,t}function x(t,e){return t.set(e),t}function b(t,e,i,n,o,a,r){var s=1/(e-i),h=1/(n-o),u=1/(a-r);return t[0]=-2*s,t[5]=-2*h,t[10]=2*u,t[12]=(e+i)*s,t[13]=(o+n)*h,t[14]=(r+a)*u,t}function k(t,e,i,n){return void 0===n&&(n=0),t[12]+=t[0]*e+t[4]*i+t[8]*n,t[13]+=t[1]*e+t[5]*i+t[9]*n,t[14]+=t[2]*e+t[6]*i+t[10]*n,t[15]+=t[3]*e+t[7]*i+t[11]*n,t}function w(t,e,i){var n=t[0],o=t[1],a=t[2],r=t[3],s=t[4],h=t[5],u=t[6],l=t[7];return t[0]=n*e+s*i,t[1]=o*e+h*i,t[2]=a*e+u*i,t[3]=r*e+l*i,t[4]=s*e-n*i,t[5]=h*e-o*i,t[6]=u*e-a*i,t[7]=l*e-r*i,t}function A(t,e){return w(t,Math.cos(e),Math.sin(e))}function T(t,e,i,n){return void 0===n&&(n=1),t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e,t[4]*=i,t[5]*=i,t[6]*=i,t[7]*=i,t[8]*=n,t[9]*=n,t[10]*=n,t[11]*=n,t}function E(t,e,i){e=n(e);var o=t.createShader(i);return t.shaderSource(o,e.join("\n")),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)||(e.forEach(function(t,e){console.log(e+1,t)}),console.log(t.getShaderInfoLog(o)),t.deleteShader(o),o=null),o}function S(t,e,i){var n=t.createProgram();return t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||(console.log("could not link shader program"),t.detachShader(n,e),t.detachShader(n,i),t.deleteProgram(n),n=null),n}function P(t,e,i){for(var n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),o=0;n>o;++o){var a=t.getActiveUniform(e,o);i[a.name]=t.getUniformLocation(e,a.name)}return i}function M(t,e,i){for(var n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),o=0;n>o;++o){var a=t.getActiveAttrib(e,o);i[a.name]=t.getAttribLocation(e,a.name)}return i}function O(t,e,i){var n=new B;return n.vs_src=e,n.fs_src=i,n.vs=E(t,n.vs_src,t.VERTEX_SHADER),n.fs=E(t,n.fs_src,t.FRAGMENT_SHADER),n.program=S(t,n.vs,n.fs),n.uniforms=P(t,n.program,{}),n.attribs=M(t,n.program,{}),n}function C(t,e,i,n,o){var a=new D;if(e instanceof Float32Array)a.type=t.FLOAT;else if(e instanceof Int8Array)a.type=t.BYTE;else if(e instanceof Uint8Array)a.type=t.UNSIGNED_BYTE;else if(e instanceof Int16Array)a.type=t.SHORT;else if(e instanceof Uint16Array)a.type=t.UNSIGNED_SHORT;else if(e instanceof Int32Array)a.type=t.INT;else{if(!(e instanceof Uint32Array))throw a.type=t.NONE,new Error;a.type=t.UNSIGNED_INT}return a.size=i,a.count=e.length/a.size,a.type_array=e,a.buffer=t.createBuffer(),a.buffer_type=n,a.buffer_draw=o,t.bindBuffer(a.buffer_type,a.buffer),t.bufferData(a.buffer_type,a.type_array,a.buffer_draw),a}function I(t,e,i,n,o){if(void 0===o&&(o=0),t.bindBuffer(n.buffer_type,n.buffer),o>0)for(var a=n.type_array.BYTES_PER_ELEMENT*n.size,r=a*o,s=0;o>s;++s){var h=a*s,u=e.attribs[i.replace(/{index}/g,s.toString())];t.vertexAttribPointer(u,n.size,n.type,!1,r,h),t.enableVertexAttribArray(u)}else{var u=e.attribs[i];t.vertexAttribPointer(u,n.size,n.type,!1,0,0),t.enableVertexAttribArray(u)}}function R(t,e,i,n,o){if(void 0===o&&(o=0),o>0)for(var a=0;o>a;++a){var r=e.attribs[i.replace(/{index}/g,a.toString())];t.disableVertexAttribArray(r)}else{var r=e.attribs[i];t.disableVertexAttribArray(r)}}var L,B,D,N,F,j,U,G,V,K,H,X;e&&e.id;return t("repeat",i),t("flatten",n),t("vec4Identity",o),t("vec4CopyColor",a),t("vec4ApplyColor",r),t("mat3x3Identity",s),t("mat3x3Copy",h),t("mat3x3Ortho",u),t("mat3x3Translate",l),t("mat3x3RotateCosSin",c),t("mat3x3Rotate",d),t("mat3x3Scale",p),t("mat3x3Transform",f),t("mat3x3ApplySpace",_),t("mat3x3ApplyAtlasPageTexcoord",m),t("mat3x3ApplyAtlasSiteTexcoord",g),t("mat3x3ApplyAtlasSitePosition",y),t("mat4x4Identity",v),t("mat4x4Copy",x),t("mat4x4Ortho",b),t("mat4x4Translate",k),t("mat4x4RotateCosSinZ",w),t("mat4x4RotateZ",A),t("mat4x4Scale",T),t("glCompileShader",E),t("glLinkProgram",S),t("glGetUniforms",P),t("glGetAttribs",M),t("glMakeShader",O),t("glMakeVertex",C),t("glSetupAttribute",I),t("glResetAttribute",R),{setters:[function(t){L=t}],execute:function(){B=function(){function t(){}return t}(),t("glShader",B),D=function(){function t(){}return t}(),t("glVertex",D),N=function(){function t(){}return t}(),t("BoneInfo",N),F=function(){function t(){this.slot_info_map={}}return t}(),t("SkinInfo",F),j=function(){function t(){this.attachment_info_map={}}return t}(),t("SlotInfo",j),U=function(){function t(t){this.type=t}return t}(),t("AttachmentInfo",U),G=function(t){function e(){t.call(this,"region")}return __extends(e,t),e}(U),t("RegionAttachmentInfo",G),V=function(t){function e(){t.call(this,"boundingbox")}return __extends(e,t),e}(U),t("BoundingBoxAttachmentInfo",V),K=function(t){function e(){t.call(this,"mesh")}return __extends(e,t),e}(U),t("MeshAttachmentInfo",K),H=function(t){function e(){t.call(this,"skinnedmesh")}return __extends(e,t),e}(U),t("SkinnedMeshAttachmentInfo",H),X=function(){function t(t){this.bone_info_map={},this.skin_info_map={},this.gl_textures={},this.gl_projection=v(new Float32Array(16)),this.gl_modelview=s(new Float32Array(9)),this.gl_tex_matrix=s(new Float32Array(9)),this.gl_color=o(new Float32Array(4));var e=this;if(e.gl=t,t){var n=["precision mediump int;","precision mediump float;","uniform mat4 uProjection;","uniform mat3 uModelview;","uniform mat3 uTexMatrix;","attribute vec2 aVertexPosition;","attribute vec2 aVertexTexCoord;","varying vec3 vTexCoord;","void main(void) {"," vTexCoord = uTexMatrix * vec3(aVertexTexCoord, 1.0);"," gl_Position = uProjection * vec4(uModelview * vec3(aVertexPosition, 1.0), 1.0);","}"],a=["precision mediump int;","precision mediump float;","uniform mat4 uProjection;","uniform mat3 uModelview;","uniform mat3 uTexMatrix;","uniform float uMorphWeight;","attribute vec2 aVertexPosition;","attribute vec2 aVertexTexCoord;","attribute vec2 aVertexMorph0Position;","attribute vec2 aVertexMorph1Position;","varying vec3 vTexCoord;","void main(void) {"," vTexCoord = uTexMatrix * vec3(aVertexTexCoord, 1.0);"," gl_Position = uProjection * vec4(uModelview * vec3(aVertexPosition + mix(aVertexMorph0Position, aVertexMorph1Position, uMorphWeight), 1.0), 1.0);","}"],r=["precision mediump int;","precision mediump float;","uniform sampler2D uSampler;","uniform vec4 uColor;","varying vec3 vTexCoord;","void main(void) {"," gl_FragColor = uColor * texture2D(uSampler, vTexCoord.st);","}"];e.gl_mesh_shader=O(t,n,r),e.gl_ffd_mesh_shader=O(t,a,r),e.gl_region_vertex_position=C(t,new Float32Array([-1,-1,1,-1,1,1,-1,1]),2,t.ARRAY_BUFFER,t.STATIC_DRAW),e.gl_region_vertex_texcoord=C(t,new Float32Array([0,1,1,1,1,0,0,0]),2,t.ARRAY_BUFFER,t.STATIC_DRAW),e.gl_skin_shader_modelview_count=16,e.gl_skin_shader_modelview_array=new Float32Array(9*e.gl_skin_shader_modelview_count),e.gl_skin_shader_blenders_count=8;var h=["precision mediump int;","precision mediump float;","uniform mat4 uProjection;","uniform mat3 uModelviewArray["+e.gl_skin_shader_modelview_count+"];","uniform mat3 uTexMatrix;","attribute vec2 aVertexPosition;",i("attribute vec2 aVertexBlenders{index};",e.gl_skin_shader_blenders_count),"attribute vec2 aVertexTexCoord;","varying vec3 vTexCoord;","void main(void) {"," vTexCoord = uTexMatrix * vec3(aVertexTexCoord, 1.0);"," vec3 position = vec3(aVertexPosition, 1.0);"," vec3 blendPosition = vec3(0.0);",i(" blendPosition += (uModelviewArray[int(aVertexBlenders{index}.x)] * position) * aVertexBlenders{index}.y;",e.gl_skin_shader_blenders_count)," gl_Position = uProjection * vec4(blendPosition, 1.0);","}"],u=["precision mediump int;","precision mediump float;","uniform mat4 uProjection;","uniform mat3 uModelviewArray["+e.gl_skin_shader_modelview_count+"];","uniform mat3 uTexMatrix;","uniform float uMorphWeight;","attribute vec2 aVertexPosition;",i("attribute vec2 aVertexBlenders{index};",e.gl_skin_shader_blenders_count),"attribute vec2 aVertexTexCoord;","attribute vec2 aVertexMorph0Position;","attribute vec2 aVertexMorph1Position;","varying vec3 vTexCoord;","void main(void) {"," vTexCoord = uTexMatrix * vec3(aVertexTexCoord, 1.0);"," vec3 position = vec3(aVertexPosition + mix(aVertexMorph0Position, aVertexMorph1Position, uMorphWeight), 1.0);"," vec3 blendPosition = vec3(0.0);",i(" blendPosition += (uModelviewArray[int(aVertexBlenders{index}.x)] * position) * aVertexBlenders{index}.y;",e.gl_skin_shader_blenders_count)," gl_Position = uProjection * vec4(blendPosition, 1.0);","}"],l=["precision mediump int;","precision mediump float;","uniform sampler2D uSampler;","uniform vec4 uColor;","varying vec3 vTexCoord;","void main(void) {"," gl_FragColor = uColor * texture2D(uSampler, vTexCoord.st);","}"];e.gl_skin_shader=O(t,h,l),e.gl_ffd_skin_shader=O(t,u,l)}}return t.prototype.dropData=function(t,e){var i=this,n=i.gl;n&&(Object.keys(i.gl_textures).forEach(function(t){var e=i.gl_textures[t];n.deleteTexture(e),delete i.gl_textures[t]}),i.gl_textures={},Object.keys(i.bone_info_map).forEach(function(t){i.bone_info_map[t]}),i.bone_info_map={},Object.keys(i.skin_info_map).forEach(function(t){var e=i.skin_info_map[t];Object.keys(e.slot_info_map).forEach(function(i){var o=e.slot_info_map[i];Object.keys(o.attachment_info_map).forEach(function(e){var a=o.attachment_info_map[e];switch(a.type){case"mesh":var r=a;n.deleteBuffer(r.gl_vertex_position.buffer),n.deleteBuffer(r.gl_vertex_texcoord.buffer),n.deleteBuffer(r.gl_vertex_triangle.buffer),Object.keys(r.anim_ffd_attachments).forEach(function(t){var e=r.anim_ffd_attachments[t];e.ffd_keyframes.forEach(function(t){n.deleteBuffer(t.gl_vertex.buffer)})});break;case"skinnedmesh":var s=a;n.deleteBuffer(s.gl_vertex_position.buffer),n.deleteBuffer(s.gl_vertex_blenders.buffer),n.deleteBuffer(s.gl_vertex_texcoord.buffer),n.deleteBuffer(s.gl_vertex_triangle.buffer),Object.keys(s.anim_ffd_attachments).forEach(function(t){var e=s.anim_ffd_attachments[t];e.ffd_keyframes.forEach(function(t){n.deleteBuffer(t.gl_vertex.buffer)})});break;default:console.log("TODO",t,i,e,a.type)}})})}),i.skin_info_map={})},t.prototype.loadData=function(t,e,i){var n=this,o=n.gl;o&&(t.iterateBones(function(t,e){var i=n.bone_info_map[t]=new N;i.setup_space=L.Space.invert(e.world_space,new L.Space)}),t.iterateSkins(function(e,i){var a=n.skin_info_map[e]=new F;i.iterateAttachments(function(i,r,s,h){if(h){var u=a.slot_info_map[i]=a.slot_info_map[i]||new j;switch(h.type){case"mesh":var l=h,c=u.attachment_info_map[s]=new K,d=l.vertices.length/2,p=new Float32Array(l.vertices),f=new Float32Array(l.uvs),_=new Uint16Array(l.triangles);c.gl_vertex_position=C(o,p,2,o.ARRAY_BUFFER,o.STATIC_DRAW),c.gl_vertex_texcoord=C(o,f,2,o.ARRAY_BUFFER,o.STATIC_DRAW),c.gl_vertex_triangle=C(o,_,1,o.ELEMENT_ARRAY_BUFFER,o.STATIC_DRAW);var m=c.anim_ffd_attachments={};t.iterateAnims(function(t,n){var a=n.ffds&&n.ffds[e],r=a&&a.ffd_slots[i],h=r&&r.ffd_attachments[s];if(h){var u=m[t]={},l=u.ffd_keyframes=[];h.ffd_keyframes.forEach(function(t,e){var i=l[e]={},n=new Float32Array(2*d);n.subarray(t.offset,t.offset+t.vertices.length).set(new Float32Array(t.vertices)),i.gl_vertex=C(o,n,2,o.ARRAY_BUFFER,o.STATIC_DRAW)})}});break;case"skinnedmesh":for(var g,y=h,v=u.attachment_info_map[s]=new H,x=y.uvs.length/2,p=new Float32Array(2*x),b=new Float32Array(2*n.gl_skin_shader_blenders_count*x),f=new Float32Array(y.uvs),_=new Uint16Array(y.triangles),k=v.blend_bone_index_array=[],w=function(e,i){for(var o=y.vertices[i++],a=[],r=0;o>r;++r){var h=y.vertices[i++],u=y.vertices[i++],l=y.vertices[i++],c=y.vertices[i++];a.push({position:new L.Vector(u,l),bone_index:h,weight:c})}if(a=a.sort(function(t,e){return e.weight-t.weight}),a.length>n.gl_skin_shader_blenders_count){console.log("blend array length for",s,"is",a.length,"so clamp to",n.gl_skin_shader_blenders_count),a.length=n.gl_skin_shader_blenders_count;var d=0;a.forEach(function(t){d+=t.weight}),a.forEach(function(t){t.weight/=d})}var f=0,_=0,m=new L.Vector,v=2*e*n.gl_skin_shader_blenders_count;a.forEach(function(e,i){-1===k.indexOf(e.bone_index)&&k.push(e.bone_index);var n=t.bone_keys[e.bone_index],o=t.bones[n];L.Space.transform(o.world_space,e.position,m),f+=m.x*e.weight,_+=m.y*e.weight,b[v++]=k.indexOf(e.bone_index),b[v++]=e.weight});var x=2*e;p[x++]=f,p[x++]=_,k.length>n.gl_skin_shader_modelview_count&&console.log("blend bone index array length for",s,"is",k.length,"greater than",n.gl_skin_shader_modelview_count),g=i},A=0,T=0;x>A;++A)w(A,T),T=g;v.gl_vertex_position=C(o,p,2,o.ARRAY_BUFFER,o.STATIC_DRAW),v.gl_vertex_blenders=C(o,b,2,o.ARRAY_BUFFER,o.STATIC_DRAW),v.gl_vertex_texcoord=C(o,f,2,o.ARRAY_BUFFER,o.STATIC_DRAW),v.gl_vertex_triangle=C(o,_,1,o.ELEMENT_ARRAY_BUFFER,o.STATIC_DRAW);var E=v.anim_ffd_attachments={};t.iterateAnims(function(t,n){var a=n.ffds&&n.ffds[e],r=a&&a.ffd_slots[i],h=r&&r.ffd_attachments[s];if(h){var u=E[t]={},l=u.ffd_keyframes=[];h.ffd_keyframes.forEach(function(t,e){for(var i=l[e]={},n=new Float32Array(2*x),a=0,r=0,s=0;x>a;++a){for(var h=y.vertices[r++],u=0,c=0,d=0;h>d;++d){var p=(y.vertices[r++],y.vertices[r++],y.vertices[r++],y.vertices[r++]),f=t.vertices[s-t.offset]||0;++s;var _=t.vertices[s-t.offset]||0;++s,u+=f*p,c+=_*p}var m=2*a;n[m++]=u,n[m++]=c}i.gl_vertex=C(o,n,2,o.ARRAY_BUFFER,o.STATIC_DRAW)})}})}}})}),e?e.pages.forEach(function(t){if("RGBA8888"!==t.format)throw new Error(t.format);var e=o.NONE;switch(t.min_filter){case"Nearest":e=o.NEAREST;break;default:case"Linear":e=o.LINEAR;break;case"MipMapNearestNearest":e=o.NEAREST_MIPMAP_NEAREST;break;case"MipMapLinearNearest":e=o.LINEAR_MIPMAP_NEAREST;break;case"MipMapNearestLinear":e=o.NEAREST_MIPMAP_LINEAR;break;case"MipMapLinearLinear":e=o.LINEAR_MIPMAP_LINEAR}var a=o.NONE;switch(t.mag_filter){case"Nearest":a=o.NEAREST;break;default:case"Linear":a=o.LINEAR}var r=o.NONE;switch(t.wrap_s){case"Repeat":r=o.REPEAT;break;default:case"ClampToEdge":r=o.CLAMP_TO_EDGE;break;case"MirroredRepeat":r=o.MIRRORED_REPEAT}var s=o.NONE;switch(t.wrap_t){case"Repeat":s=o.REPEAT;break;default:case"ClampToEdge":s=o.CLAMP_TO_EDGE;break;case"MirroredRepeat":s=o.MIRRORED_REPEAT}var h=t.name,u=i[h],l=n.gl_textures[h]=o.createTexture();o.bindTexture(o.TEXTURE_2D,l),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,u),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,e),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,a),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,r),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,s)}):t.iterateSkins(function(t,e){e.iterateAttachments(function(t,e,a,r){if(r)switch(r.type){case"region":case"mesh":case"skinnedmesh":var s=a,h=i[s],u=n.gl_textures[s]=o.createTexture();o.bindTexture(o.TEXTURE_2D,u),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,h),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE)}})}))},t.prototype.drawPose=function(t,e){var i=this,n=i.gl;if(n){var o=i.gl_projection,r=i.gl_modelview,u=i.gl_tex_matrix,l=i.gl_color,c=l[3];t.iterateAttachments(function(d,f,v,x,b){if(b&&"boundingbox"!==b.type){var k=e&&e.sites[x],w=k&&k.page,A=w&&w.name||x,T=i.gl_textures[A];if(T){switch(s(r),s(u),m(u,w),g(u,k),a(l,f.color),l[3]*=c,n.enable(n.BLEND),f.blend){default:case"normal":n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA);break;case"additive":n.blendFunc(n.SRC_ALPHA,n.ONE);break;case"multiply":n.blendFunc(n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA);break;case"screen":n.blendFunc(n.ONE,n.ONE_MINUS_SRC_COLOR)}var E=i.skin_info_map[t.skin_key],S=i.skin_info_map["default"],P=E.slot_info_map[d]||S.slot_info_map[d];switch(b.type){case"region":var M=t.bones[f.bone_key],O=b;P.attachment_info_map[x];_(r,M.world_space),_(r,O.local_space),p(r,O.width/2,O.height/2),y(r,k);var C=i.gl_mesh_shader,B=i.gl_region_vertex_position,D=i.gl_region_vertex_texcoord;n.useProgram(C.program),n.uniformMatrix4fv(C.uniforms.uProjection,!1,o),n.uniformMatrix3fv(C.uniforms.uModelview,!1,r),n.uniformMatrix3fv(C.uniforms.uTexMatrix,!1,u),n.uniform4fv(C.uniforms.uColor,l),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,T),n.uniform1i(C.uniforms.uSampler,0),I(n,C,"aVertexPosition",B),I(n,C,"aVertexTexCoord",D),n.drawArrays(n.TRIANGLE_FAN,0,B.count),R(n,C,"aVertexPosition",B),R(n,C,"aVertexTexCoord",D),n.bindTexture(n.TEXTURE_2D,null),n.useProgram(null);break;case"mesh":var M=t.bones[f.bone_key],N=P.attachment_info_map[x];_(r,M.world_space),y(r,k);var F=t.data.anims[t.anim_key],j=F&&F.ffds&&F.ffds[t.skin_key],U=j&&j.ffd_slots[d],G=U&&U.ffd_attachments[x],V=G&&G.ffd_keyframes,K=L.Keyframe.find(V,t.time);if(-1!==K){var H=0,X=V[K],W=K+1,Y=V[W];Y?H=X.curve.evaluate((t.time-X.time)/(Y.time-X.time)):(W=K,Y=V[W]);var z=N.anim_ffd_attachments[t.anim_key],J=z.ffd_keyframes[K],q=z.ffd_keyframes[W],C=i.gl_ffd_mesh_shader,B=N.gl_vertex_position,D=N.gl_vertex_texcoord,$=N.gl_vertex_triangle;n.useProgram(C.program),n.uniformMatrix4fv(C.uniforms.uProjection,!1,o),n.uniformMatrix3fv(C.uniforms.uModelview,!1,r),n.uniformMatrix3fv(C.uniforms.uTexMatrix,!1,u),n.uniform4fv(C.uniforms.uColor,l),n.uniform1f(C.uniforms.uMorphWeight,H),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,T),n.uniform1i(C.uniforms.uSampler,0),I(n,C,"aVertexPosition",B),I(n,C,"aVertexMorph0Position",J.gl_vertex),I(n,C,"aVertexMorph1Position",q.gl_vertex),I(n,C,"aVertexTexCoord",D),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,$.buffer),n.drawElements(n.TRIANGLES,$.count,$.type,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),R(n,C,"aVertexPosition",B),R(n,C,"aVertexMorph0Position",J.gl_vertex),R(n,C,"aVertexMorph1Position",q.gl_vertex),R(n,C,"aVertexTexCoord",D),n.bindTexture(n.TEXTURE_2D,null),n.useProgram(null)}else{var C=i.gl_mesh_shader,B=N.gl_vertex_position,D=N.gl_vertex_texcoord,$=N.gl_vertex_triangle;n.useProgram(C.program),n.uniformMatrix4fv(C.uniforms.uProjection,!1,o),n.uniformMatrix3fv(C.uniforms.uModelview,!1,r),n.uniformMatrix3fv(C.uniforms.uTexMatrix,!1,u),n.uniform4fv(C.uniforms.uColor,l),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,T),n.uniform1i(C.uniforms.uSampler,0),I(n,C,"aVertexPosition",B),I(n,C,"aVertexTexCoord",D),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,$.buffer),n.drawElements(n.TRIANGLES,$.count,$.type,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),R(n,C,"aVertexPosition",B),R(n,C,"aVertexTexCoord",D),n.bindTexture(n.TEXTURE_2D,null),n.useProgram(null)}break;case"skinnedmesh":for(var Q=P.attachment_info_map[x],Z=Q.blend_bone_index_array,tt=0;tt<Z.length;++tt){var et=Z[tt],it=t.bone_keys[et],M=t.bones[it],nt=i.bone_info_map[it];if(tt<i.gl_skin_shader_modelview_count){var ot=i.gl_skin_shader_modelview_array.subarray(9*tt,9*(tt+1));h(ot,r),_(ot,M.world_space),_(ot,nt.setup_space),y(ot,k)}}var F=t.data.anims[t.anim_key],j=F&&F.ffds&&F.ffds[t.skin_key],U=j&&j.ffd_slots[d],G=U&&U.ffd_attachments[x],V=G&&G.ffd_keyframes,K=L.Keyframe.find(V,t.time);if(-1!==K){var H=0,X=V[K],W=K+1,Y=V[W];Y?H=X.curve.evaluate((t.time-X.time)/(Y.time-X.time)):(W=K,Y=V[W]);var z=Q.anim_ffd_attachments[t.anim_key],J=z.ffd_keyframes[K],q=z.ffd_keyframes[W],C=i.gl_ffd_skin_shader,B=Q.gl_vertex_position,at=Q.gl_vertex_blenders,D=Q.gl_vertex_texcoord,$=Q.gl_vertex_triangle;n.useProgram(C.program),n.uniformMatrix4fv(C.uniforms.uProjection,!1,o),n.uniformMatrix3fv(C.uniforms["uModelviewArray[0]"],!1,i.gl_skin_shader_modelview_array),n.uniformMatrix3fv(C.uniforms.uTexMatrix,!1,u),n.uniform4fv(C.uniforms.uColor,l),n.uniform1f(C.uniforms.uMorphWeight,H),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,T),n.uniform1i(C.uniforms.uSampler,0),I(n,C,"aVertexPosition",B),I(n,C,"aVertexBlenders{index}",at,i.gl_skin_shader_blenders_count),I(n,C,"aVertexMorph0Position",J.gl_vertex),I(n,C,"aVertexMorph1Position",q.gl_vertex),I(n,C,"aVertexTexCoord",D),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,$.buffer),n.drawElements(n.TRIANGLES,$.count,$.type,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),R(n,C,"aVertexPosition",B),R(n,C,"aVertexBlenders{index}",at,i.gl_skin_shader_blenders_count),R(n,C,"aVertexMorph0Position",J.gl_vertex),R(n,C,"aVertexMorph1Position",q.gl_vertex),R(n,C,"aVertexTexCoord",D),n.bindTexture(n.TEXTURE_2D,null),n.useProgram(null)}else{var C=i.gl_skin_shader,B=Q.gl_vertex_position,at=Q.gl_vertex_blenders,D=Q.gl_vertex_texcoord,$=Q.gl_vertex_triangle;n.useProgram(C.program),n.uniformMatrix4fv(C.uniforms.uProjection,!1,o),n.uniformMatrix3fv(C.uniforms["uModelviewArray[0]"],!1,i.gl_skin_shader_modelview_array),n.uniformMatrix3fv(C.uniforms.uTexMatrix,!1,u),n.uniform4fv(C.uniforms.uColor,l),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,T),n.uniform1i(C.uniforms.uSampler,0),I(n,C,"aVertexPosition",B),I(n,C,"aVertexBlenders{index}",at,i.gl_skin_shader_blenders_count),I(n,C,"aVertexTexCoord",D),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,$.buffer),n.drawElements(n.TRIANGLES,$.count,$.type,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),R(n,C,"aVertexPosition",B),R(n,C,"aVertexBlenders{index}",at,i.gl_skin_shader_blenders_count),R(n,C,"aVertexTexCoord",D),n.bindTexture(n.TEXTURE_2D,null),n.useProgram(null)}}}}}),l[3]=c}},t}(),t("RenderWebGL",X)}}}),System.register("dijon/spine/render-ctx2d",["dijon/spine/spine","dijon/spine/render-webgl"],function(t,e){"use strict";function i(t,e){e&&(t.translate(e.position.x,e.position.y),t.rotate(e.rotation.rad),t.scale(e.scale.x,e.scale.y))}function n(t,e){e&&(t.scale(1/e.original_w,1/e.original_h),t.translate(2*e.offset_x-(e.original_w-e.w),e.original_h-e.h-2*e.offset_y),t.scale(e.w,e.h))}function o(t,e,i){void 0===e&&(e="grey"),void 0===i&&(i=1),t.beginPath(),t.arc(0,0,12*i,0,2*Math.PI,!1),t.strokeStyle=e,t.stroke()}function a(t,e,i){void 0===e&&(e="blue"),void 0===i&&(i=1),t.beginPath(),t.arc(0,0,12*i,0,2*Math.PI,!1),t.strokeStyle=e,t.stroke(),t.beginPath(),t.moveTo(0,0),t.lineTo(24*i,0),t.strokeStyle="red",t.stroke(),t.beginPath(),t.moveTo(0,0),t.lineTo(0,24*i),t.strokeStyle="green",t.stroke()}function r(t,e,i,n,o){void 0===n&&(n="grey"),void 0===o&&(o=""),t.beginPath();for(var a=0;a<e.length;){var r=2*e[a++],s=i[r],h=i[r+1],u=2*e[a++],l=i[u],c=i[u+1],d=2*e[a++],p=i[d],f=i[d+1];t.moveTo(s,h),t.lineTo(l,c),t.lineTo(p,f),t.lineTo(s,h)}o&&(t.fillStyle=o,t.fill()),t.strokeStyle=n,t.stroke()}function s(t,e,i,n,o,a,r){var s=new Float32Array(9),h=new Float32Array(2);l.mat3x3Identity(s),l.mat3x3Scale(s,o.width,o.height),l.mat3x3ApplyAtlasPageTexcoord(s,r),l.mat3x3ApplyAtlasSiteTexcoord(s,a);for(var u=0;u<e.length;){var c=2*e[u++],d=i.subarray(c,c+2),p=d[0],f=d[1],_=l.mat3x3Transform(s,n.subarray(c,c+2),h),m=_[0],g=_[1],y=2*e[u++],v=i.subarray(y,y+2),x=v[0],b=v[1],k=l.mat3x3Transform(s,n.subarray(y,y+2),h),w=k[0],A=k[1],T=2*e[u++],E=i.subarray(T,T+2),S=E[0],P=E[1],M=l.mat3x3Transform(s,n.subarray(T,T+2),h),O=M[0],C=M[1];t.save(),t.beginPath(),t.moveTo(p,f),t.lineTo(x,b),t.lineTo(S,P),t.closePath(),t.clip(),x-=p,b-=f,S-=p,P-=f,w-=m,A-=g,O-=m,C-=g;var I=1/(w*C-O*A),R=I*(C*x-A*S),L=I*(C*b-A*P),B=I*(w*S-O*x),D=I*(w*P-O*b),N=p-(R*m+B*g),F=f-(L*m+D*g);t.transform(R,L,B,D,N,F),t.drawImage(o,0,0),t.restore()}}function h(t,e,n){e.ikc_keys.forEach(function(a){var r=e.ikcs[a],s=n[r.target_key];switch(r.bone_keys.length){case 1:var h=n[r.bone_keys[0]];t.beginPath(),t.moveTo(s.world_space.position.x,s.world_space.position.y),t.lineTo(h.world_space.position.x,h.world_space.position.y),t.strokeStyle="yellow",t.stroke(),t.save(),i(t,s.world_space),o(t,"yellow",1.5),t.restore(),t.save(),i(t,h.world_space),o(t,"yellow",.5),t.restore();break;case 2:var u=n[r.bone_keys[0]],l=n[r.bone_keys[1]];t.beginPath(),t.moveTo(s.world_space.position.x,s.world_space.position.y),t.lineTo(l.world_space.position.x,l.world_space.position.y),t.lineTo(u.world_space.position.x,u.world_space.position.y),t.strokeStyle="yellow",t.stroke(),t.save(),i(t,s.world_space),o(t,"yellow",1.5),t.restore(),t.save(),i(t,l.world_space),o(t,"yellow",.75),t.restore(),t.save(),i(t,u.world_space),o(t,"yellow",.5),t.restore()}})}var u,l,c,d,p,f,_,m,g,y,v;e&&e.id;return{setters:[function(t){u=t},function(t){l=t}],execute:function(){c=function(){function t(){}return t}(),t("BoneInfo",c),d=function(){function t(){this.slot_info_map={}}return t}(),t("SkinInfo",d),p=function(){function t(){this.attachment_info_map={}}return t}(),t("SlotInfo",p),f=function(){function t(t){this.type=t}return t}(),t("AttachmentInfo",f),_=function(t){function e(){t.call(this,"region")}return __extends(e,t),e}(f),t("RegionAttachmentInfo",_),m=function(t){function e(){t.call(this,"boundingbox")}return __extends(e,t),e}(f),t("BoundingBoxAttachmentInfo",m),g=function(t){function e(){t.call(this,"mesh")}return __extends(e,t),e}(f),t("MeshAttachmentInfo",g),y=function(t){function e(){t.call(this,"skinnedmesh")}return __extends(e,t),e}(f),t("SkinnedMeshAttachmentInfo",y),v=function(){function t(t){this.images={},this.skin_info_map={},this.region_vertex_position=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.region_vertex_texcoord=new Float32Array([0,1,1,1,1,0,0,0]),this.region_vertex_triangle=new Uint16Array([0,1,2,0,2,3]),
this.ctx=t}return t.prototype.dropData=function(t,e){this.images={},this.skin_info_map={}},t.prototype.loadData=function(t,e,i){var n=this;this.images=i,t.iterateSkins(function(e,i){var o=n.skin_info_map[e]=new d;i.iterateAttachments(function(e,i,n,a){if(a){var r=o.slot_info_map[e]=o.slot_info_map[e]||new p;switch(a.type){case"mesh":var s=a,h=r.attachment_info_map[n]=new g,l=h.vertex_count=s.vertices.length/2;h.vertex_position=new Float32Array(s.vertices),h.vertex_texcoord=new Float32Array(s.uvs),h.vertex_triangle=new Uint16Array(s.triangles);break;case"skinnedmesh":for(var c=a,d=r.attachment_info_map[n]=new y,l=d.vertex_count=c.uvs.length/2,f=d.vertex_setup_position=new Float32Array(2*l),_=d.vertex_blend_position=new Float32Array(2*l),m=(d.vertex_texcoord=new Float32Array(c.uvs),d.vertex_triangle=new Uint16Array(c.triangles),new u.Vector),v=0,x=0;l>v;++v){for(var b=c.vertices[x++],k=0,w=0,A=0;b>A;++A){var T=c.vertices[x++],E=(m.x=c.vertices[x++],m.y=c.vertices[x++],c.vertices[x++]),S=t.bone_keys[T],P=t.bones[S];u.Space.transform(P.world_space,m,m),k+=m.x*E,w+=m.y*E}var M=2*v;f[M++]=k,f[M++]=w}_.set(f)}}})}),this.images=i},t.prototype.updatePose=function(t,e){var i=this;t.iterateAttachments(function(e,n,o,a,r){if(r){var s=i.skin_info_map[t.skin_key],h=i.skin_info_map["default"],l=s.slot_info_map[e]||h.slot_info_map[e];switch(r.type){case"mesh":var c=r,d=l.attachment_info_map[a],p=t.data.anims[t.anim_key],f=p&&p.ffds&&p.ffds[t.skin_key],_=f&&f.ffd_slots[e],m=_&&_.ffd_attachments[a],g=m&&m.ffd_keyframes,y=u.Keyframe.find(g,t.time);if(-1!==y){var v=0,x=g[y],b=g[y+1];b?v=x.curve.evaluate((t.time-x.time)/(b.time-x.time)):b=x;for(var k=0;k<d.vertex_position.length;++k){var w=x.vertices[k-x.offset]||0,A=b.vertices[k-b.offset]||0;d.vertex_position[k]=c.vertices[k]+u.tween(w,A,v)}}break;case"skinnedmesh":var T=r,E=l.attachment_info_map[a],p=t.data.anims[t.anim_key],f=p&&p.ffds&&p.ffds[t.skin_key],_=f&&f.ffd_slots[e],m=_&&_.ffd_attachments[a],g=m&&m.ffd_keyframes,y=u.Keyframe.find(g,t.time);if(-1!==y){var v=0,x=g[y],b=g[y+1];b?v=x.curve.evaluate((t.time-x.time)/(b.time-x.time)):b=x;for(var S=E.vertex_blend_position,P=new u.Vector,M=0,k=0,O=0;M<E.vertex_count;++M){for(var C=T.vertices[k++],I=0,R=0,L=0;C>L;++L){var B=T.vertices[k++];P.x=T.vertices[k++],P.y=T.vertices[k++];var D=T.vertices[k++],N=t.bone_keys[B],F=t.bones[N],j=x.vertices[O-x.offset]||0,U=b.vertices[O-b.offset]||0;P.x+=u.tween(j,U,v),++O;var G=x.vertices[O-x.offset]||0,V=b.vertices[O-b.offset]||0;P.y+=u.tween(G,V,v),++O,u.Space.transform(F.world_space,P,P),I+=P.x*D,R+=P.y*D}var K=2*M;S[K++]=I,S[K++]=R}}else for(var S=E.vertex_blend_position,P=new u.Vector,M=0,k=0;M<E.vertex_count;++M){for(var C=T.vertices[k++],I=0,R=0,L=0;C>L;++L){var B=T.vertices[k++];P.x=T.vertices[k++],P.y=T.vertices[k++];var D=T.vertices[k++],N=t.bone_keys[B],F=t.bones[N];u.Space.transform(F.world_space,P,P),I+=P.x*D,R+=P.y*D}var K=2*M;S[K++]=I,S[K++]=R}}}})},t.prototype.drawPose=function(t,e){var o=this;this.updatePose(t,e),t.iterateAttachments(function(a,r,h,u,l){if(l&&"boundingbox"!==l.type){var c=e&&e.sites[u],d=c&&c.page,p=d&&d.name||u,f=o.images[p];if(f&&f.complete){switch(o.ctx.save(),r.blend){default:case"normal":o.ctx.globalCompositeOperation="source-over";break;case"additive":o.ctx.globalCompositeOperation="lighter";break;case"multiply":o.ctx.globalCompositeOperation="multiply";break;case"screen":o.ctx.globalCompositeOperation="screen"}var _=o.skin_info_map[t.skin_key],m=o.skin_info_map["default"],g=_.slot_info_map[a]||m.slot_info_map[a];switch(l.type){case"region":var y=t.bones[r.bone_key],v=l;g.attachment_info_map[u];i(o.ctx,y.world_space),i(o.ctx,v.local_space),n(o.ctx,c),o.ctx.scale(v.width/2,v.height/2),s(o.ctx,o.region_vertex_triangle,o.region_vertex_position,o.region_vertex_texcoord,f,c,d);break;case"mesh":var y=t.bones[r.bone_key],x=g.attachment_info_map[u];i(o.ctx,y.world_space),n(o.ctx,c),s(o.ctx,x.vertex_triangle,x.vertex_position,x.vertex_texcoord,f,c,d);break;case"skinnedmesh":var b=g.attachment_info_map[u];n(o.ctx,c),s(o.ctx,b.vertex_triangle,b.vertex_blend_position,b.vertex_texcoord,f,c,d)}o.ctx.restore()}}})},t.prototype.drawDebugPose=function(t,e){var o=this,s=o.ctx;o.updatePose(t,e),t.iterateAttachments(function(a,h,u,l,c){if(c){s.save();var d=o.skin_info_map[t.skin_key],p=o.skin_info_map["default"],f=d.slot_info_map[a]||p.slot_info_map[a];switch(c.type){case"region":var _=t.bones[h.bone_key],m=e&&e.sites[l],g=c;f.attachment_info_map[l];i(s,_.world_space),i(s,g.local_space),n(s,m),s.beginPath(),s.rect(-g.width/2,-g.height/2,g.width,g.height),s.fillStyle="rgba(127,127,127,0.25)",s.fill(),s.strokeStyle="rgba(127,127,127,1.0)",s.stroke();break;case"boundingbox":var _=t.bones[h.bone_key],y=c;f.attachment_info_map[l];i(s,_.world_space),s.beginPath();var v=0;y.vertices.forEach(function(t,e){1&e?s.lineTo(v,t):v=t}),s.closePath(),s.strokeStyle="yellow",s.stroke();break;case"mesh":var _=t.bones[h.bone_key],m=e&&e.sites[l],x=f.attachment_info_map[l];i(s,_.world_space),n(s,m),r(s,x.vertex_triangle,x.vertex_position,"rgba(127,127,127,1.0)","rgba(127,127,127,0.25)");break;case"skinnedmesh":var m=e&&e.sites[l],b=f.attachment_info_map[l];n(s,m),r(s,b.vertex_triangle,b.vertex_blend_position,"rgba(127,127,127,1.0)","rgba(127,127,127,0.25)")}s.restore()}}),t.iterateBones(function(t,e){s.save(),i(s,e.world_space),a(s),s.restore()}),h(s,t.data,t.bones)},t.prototype.drawDebugData=function(t,e){var o=this,s=o.ctx;t.data.iterateAttachments(t.skin_key,function(a,h,u,l,c){if(c){s.save();var d=o.skin_info_map[t.skin_key],p=o.skin_info_map["default"],f=d.slot_info_map[a]||p.slot_info_map[a];switch(c.type){case"region":var _=t.data.bones[h.bone_key],m=e&&e.sites[l],g=c;f.attachment_info_map[l];i(s,_.world_space),i(s,g.local_space),n(s,m),s.beginPath(),s.rect(-g.width/2,-g.height/2,g.width,g.height),s.fillStyle="rgba(127,127,127,0.25)",s.fill(),s.strokeStyle="rgba(127,127,127,1.0)",s.stroke();break;case"boundingbox":var _=t.data.bones[h.bone_key],y=c;f.attachment_info_map[l];i(s,_.world_space),s.beginPath();var v=0;y.vertices.forEach(function(t,e){1&e?s.lineTo(v,t):v=t}),s.closePath(),s.strokeStyle="yellow",s.stroke();break;case"mesh":var _=t.data.bones[h.bone_key],m=e&&e.sites[l],x=f.attachment_info_map[l];i(s,_.world_space),n(s,m),r(s,x.vertex_triangle,x.vertex_position,"rgba(127,127,127,1.0)","rgba(127,127,127,0.25)");break;case"skinnedmesh":var m=e&&e.sites[l],b=f.attachment_info_map[l];n(s,m),r(s,b.vertex_triangle,b.vertex_setup_position,"rgba(127,127,127,1.0)","rgba(127,127,127,0.25)")}s.restore()}}),t.data.iterateBones(function(t,e){s.save(),i(s,e.world_space),a(s),s.restore()}),h(s,t.data,t.data.bones)},t}(),t("RenderCtx2D",v)}}}),System.register("dijon/display",["dijon/application","dijon/spine/spine","dijon/spine/atlas","dijon/spine/render-ctx2d"],function(t,e){"use strict";var i,n,o,a,r,s,h,u,l,c,d;e&&e.id;return{setters:[function(t){i=t},function(t){n=t},function(t){o=t},function(t){a=t}],execute:function(){r=function(t){function e(e,n,o,a,r,s){void 0===r&&(r="dSprite"),void 0===s&&(s=null),t.call(this,i.Application.getInstance().game,e,n,o,a),this.name=r,this._hasComponents=!1,this._componentKeys=[],this._components={},this.addComponents=function(t){if("undefined"==typeof t.length)throw new Error("Dijon.UIGroup components must be an array");for(;t.length>0;)this.addComponent(t.shift())},s&&this.addComponents(s)}return __extends(e,t),e.prototype.update=function(){this._hasComponents&&this.updateComponents()},e.prototype.destroy=function(){this.removeAllComponents(),t.prototype.destroy.call(this)},e.prototype.init=function(){},e.prototype.buildInterface=function(){},e.prototype._updateComponentKeys=function(){this._componentKeys=Object.keys(this._components),this._hasComponents=this._componentKeys.length>0},e.prototype.addComponent=function(t){return t.setOwner(this),t.init(),t.buildInterface(),this._components[t.name]=t,this._updateComponentKeys(),t},e.prototype.updateComponents=function(){var t=this;this._componentKeys.forEach(function(e){t.updateComponent(e)})},e.prototype.updateComponent=function(t){this._components[t].update()},e.prototype.removeAllComponents=function(){for(;this._componentKeys.length>0;)this.removeComponent(this._componentKeys.pop())},e.prototype.removeComponent=function(t){"undefined"!=typeof this._components[t]&&(this._components[t].destroy(),this._components[t]=null,delete this._components[t],this._updateComponentKeys())},e.prototype.flatten=function(t){var e=this;void 0===t&&(t=0),0===t?this.cacheAsBitmap=!0:this.game.time.events.add(t,function(){e.cacheAsBitmap=!0},this)},e.prototype.unFlatten=function(){this.cacheAsBitmap=null},Object.defineProperty(e.prototype,"resolution",{get:function(){return this.texture.baseTexture.resolution},enumerable:!0,configurable:!0}),e}(Phaser.Sprite),t("Sprite",r),s=function(t){function e(e,i,n,o,a){t.call(this,e,i,null,null,n),this.init(),this.buildInterface(),this.setSize(o,a)}return __extends(e,t),e.prototype.init=function(){this.inputEnabled=!0},e.prototype.buildInterface=function(){this._addHitRect()},e.prototype._addHitRect=function(){this._hitWidth>0&&this._hitHeight>0&&(this.hitArea=new Phaser.Rectangle(0,0,this._hitWidth,this._hitHeight))},e.prototype.setSize=function(t,e){this._hitWidth=t||0,this._hitHeight=e||0,this._addHitRect()},e}(r),t("InvisibleButton",s),h=function(t){function e(e,n,o,a,r,s,h){void 0===e&&(e=0),void 0===n&&(n=0),void 0===o&&(o="dGroup"),void 0===a&&(a=!1),void 0===r&&(r=null),t.call(this,i.Application.getInstance().game,null,o,a,s,h),this.name=o,this._hasComponents=!1,this._componentKeys=[],this._components={},this._mediator=null,this.addComponents=function(t){if("undefined"==typeof t.length)throw new Error("Dijon.UIGroup components must be an array");for(;t.length>0;)this.addComponent(t.shift())},this.position.set(e,n),a||this.game.add.existing(this),r&&this.addComponents(r)}return __extends(e,t),e.prototype.update=function(){t.prototype.update.call(this),this._hasComponents&&this.updateComponents()},e.prototype.destroy=function(){this.removeAllComponents(),this.removeMediator(),t.prototype.destroy.call(this)},e.prototype.init=function(){},e.prototype.buildInterface=function(){},e.prototype._updateComponentKeys=function(){this._componentKeys=Object.keys(this._components),this._hasComponents=this._componentKeys.length>0},e.prototype.addComponent=function(t){return t.setOwner(this),t.init(),t.buildInterface(),this._components[t.name]=t,this._updateComponentKeys(),t},e.prototype.updateComponents=function(){var t=this;this._componentKeys.forEach(function(e){t.updateComponent(e)})},e.prototype.updateComponent=function(t){this._components[t].update()},e.prototype.removeAllComponents=function(){for(;this._componentKeys.length>0;)this.removeComponent(this._componentKeys.pop())},e.prototype.removeComponent=function(t){"undefined"!=typeof this._components[t]&&(this._components[t].destroy(),this._components[t]=null,delete this._components[t],this._updateComponentKeys())},e.prototype.flatten=function(t){var e=this;void 0===t&&(t=0),0===t?this.cacheAsBitmap=!0:this.game.time.events.add(t,function(){e.cacheAsBitmap=!0},this)},e.prototype.unFlatten=function(){this.cacheAsBitmap=null},e.prototype.removeMediator=function(){this._mediator&&(this._mediator.destroy(),this._mediator=null)},Object.defineProperty(e.prototype,"addInternal",{get:function(){return this.game.add.targetGroup=this,this.game.add},enumerable:!0,configurable:!0}),e}(Phaser.Group),t("Group",h),u=function(t){function e(n,o,a,r,s,h,u,l,c,d,p){void 0===a&&(a=""),void 0===s&&(s=e.DEFAULT_FONT_SIZE),void 0===h&&(h=e.DEFAULT_FONT_COLOR),void 0===u&&(u="left"),void 0===l&&(l=!1),void 0===c&&(c=0),void 0===d&&(d=0),void 0===p&&(p=null),t.call(this,i.Application.getInstance().game,n,o,a,e._addSettings({font:s+"px "+r,fill:h,align:u,wordWrap:l,wordWrapWidth:c},p)),this.lineSpacing=d,this.onAnimationComplete=new Phaser.Signal,this._canUpdate=!1,this._textToAnimate=[],this.stopAnimating=function(){this._canUpdate=!1,this._textToAnimate=null,this.game.time.events.remove(this._delayTimer),this.game.time.events.remove(this._repeatTimer)},this.roundPixel=function(){this.position.set(Math.round(this.x),Math.round(this.y))},this.text=a.replace(/'/g,"'"),this._lowercaseText=this.text.toLowerCase(),this.setResolution()}return __extends(e,t),e.prototype.setText=function(e){return t.prototype.setText.call(this,e),this._lowercaseText=this.text.toLowerCase(),this.setResolution(),this},e.prototype.setResolution=function(){this.game&&this.game.device.cocoonJS&&this.game.device.cocoonJS&&(this.resolution=this.game.resolution*this.game.resolution)},e.prototype._startTextAnimation=function(){this._canUpdate=!0,this._repeatTimer=this.game.time.events.repeat(100*this._letterTime,this._textLength,this._updateTextAnimation,this)},e.prototype._updateTextAnimation=function(){if(!this._canUpdate||!this._textToAnimate)return!1;var t=this._textLength-this._textToAnimate.length;this.addColor(this.style.fill,t),this.addColor("rgba(0,0,0,0)",t+1),this._textToAnimate.shift(),0===this._textToAnimate.length&&this.onAnimationComplete.dispatch()},e.prototype.setColor=function(t){return this.highlightPhrase(this.text,t,!1)},e.prototype.resetColor=function(){return this.highlightPhrase(this.text,this.style.fill,!1)},e.prototype.highlightPhrase=function(t,e,i){void 0===i&&(i=!1);var n=i?this.text:this._lowercaseText;t=i?t:t.toLowerCase();for(var o=t.length,a=n.indexOf(t),r=a+o;r>=a;)this.addColor(e,a),a++;this.addColor(this.style.fill,r)},e.prototype.animate=function(t,e){void 0===t&&(t=.1),void 0===e&&(e=0),this.game.time.events.remove(this._delayTimer),this.game.time.events.remove(this._repeatTimer),this._letterTime=t,this._textLength=this.text.length,this._textToAnimate=this.text.split("");for(var i=0,n=this._textLength;n>=i;)this.addColor("rgba(0,0,0,0)",i),i++;this._delayTimer=this.game.time.events.add(e*Phaser.Timer.SECOND,this._startTextAnimation,this)},e._addSettings=function(t,e){if(!e)return t;for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},Object.defineProperty(e.prototype,"realHeight",{get:function(){return this.scale.y*this.texture.frame.height/this.game.resolution},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"realWidth",{get:function(){return this.scale.x*this.texture.frame.width/this.game.resolution},enumerable:!0,configurable:!0}),e.DEFAULT_FONT_SIZE=12,e.DEFAULT_FONT_COLOR="#000000",e.DEFAULT_FONT="Helvetica Neue, Arial",e.GLOBAL_PADDING_X=0,e.GLOBAL_PADDING_Y=0,e}(Phaser.Text),t("Text",u),l=function(){function t(){this.game=i.Application.getInstance().game,this.name="Component"}return t.prototype.setOwner=function(t){this.owner=t},t.prototype.init=function(){},t.prototype.buildInterface=function(){},t.prototype.update=function(){},t.prototype.destroy=function(){},t}(),t("Component",l),c=function(t){function e(e,i,n,o,a,r,s,h,u,l,c){void 0===s&&(s=!0),t.call(this,e,i),this.key=a,this.texturePath=r,this.fillMiddle=s,this.topHeight=h,this.rightWidth=u,this.bottomHeight=l,this.leftWidth=c,this._interactiveBacking=null,this._inputEnabled=!1,this._currentBounds=null,this.__width=Math.round(n),this.__height=Math.round(o),this._build(),this.game.time.events.add(10,this._flatten,this)}return __extends(e,t),e.prototype._build=function(){this._inputLayer=this.add(this.game.add.group()),this._displayLayer=this.add(this.game.add.group()),this.tl=this._displayLayer.add(this.game.add.image(0,0,this.key,this.texturePath+"/tl")),this.tr=this._displayLayer.add(this.game.add.image(this.__width,0,this.key,this.texturePath+"/tr")),this.t=this._displayLayer.add(this.game.add.tileSprite(this.tl.getBounds().width,0,this.__width-this.tl.getBounds().width-this.tr.getBounds().width,this.topHeight||this.tl.getBounds().height,this.key,this.texturePath+"/t")),this.l=this._displayLayer.add(this.game.add.tileSprite(0,this.tl.getBounds().height,this.leftWidth||this.tl.getBounds().width,100,this.key,this.texturePath+"/l")),this.bl=this._displayLayer.add(this.game.add.image(0,this.__height,this.key,this.texturePath+"/bl")),this.l.height=this.__height-this.tl.getBounds().height-this.bl.getBounds().height,this.b=this._displayLayer.add(this.game.add.tileSprite(this.bl.getBounds().width,this.__height,100,this.bottomHeight||this.bl.getBounds().height,this.key,this.texturePath+"/b")),this.br=this._displayLayer.add(this.game.add.image(this.__width,this.__height,this.key,this.texturePath+"/br")),this.b.width=this.__width-this.bl.getBounds().width-this.br.getBounds().width,this.r=this._displayLayer.add(this.game.add.tileSprite(this.__width,this.tr.getBounds().height,this.rightWidth||this.tr.getBounds().width,this.__height-this.tl.getBounds().height-this.br.getBounds().height,this.key,this.texturePath+"/r")),this.tr.setPivot("tr"),this.r.setPivot("tr"),this.br.setPivot("br"),this.b.setPivot("bl"),this.bl.setPivot("bl"),this.fillMiddle&&(this.tile=this._displayLayer.add(this.game.add.tileSprite(this.tl.getBounds().width-1,this.tl.getBounds().height-1,this.__width-this.tl.getBounds().width-this.tr.getBounds().width+2,this.__height-this.tl.getBounds().height-this.br.getBounds().height+4,this.key,this.texturePath+"/tile")),this.sendToBack(this.tile))},e.prototype._addInteractiveBacking=function(){var t=this.game.add.graphics();t.beginFill(16711680,0),t.drawRect(this.x,this.y,this.__width,this.__height),t.endFill(),this._interactiveBacking=this._inputLayer.add(this.game.add.image(0,0,t.generateTexture())),this._interactiveBacking.inputEnabled=!0,this.game.world.remove(t)},e.prototype._setSize=function(){this._unflatten(),this.t.width=this.b.width=this.__width-this.tl.getBounds().width-this.tr.getBounds().width,this.r.x=this.tr.x=this.br.x=this.__width,this.l.height=this.r.height=this.__height-this.tr.getBounds().height-this.bl.getBounds().height,this.bl.y=this.b.y=this.br.y=this.__height,this.fillMiddle&&(this.tile.width=this.__width-this.tr.getBounds().width-this.tl.getBounds().width+4,this.tile.height=this.__height-this.tl.getBounds().height-this.bl.getBounds().height+4),this._interactiveBacking.width=this.__width,this._interactiveBacking.height=this.__height,this.game.time.events.add(10,this._flatten,this)},e.prototype._addInput=function(){this._interactiveBacking||this._addInteractiveBacking()},e.prototype._removeInput=function(){this._interactiveBacking&&(this._interactiveBacking.inputEnabled=!1)},e.prototype._unflatten=function(){this._displayLayer.cacheAsBitmap=null},e.prototype._flatten=function(){this._displayLayer.cacheAsBitmap=!0},Object.defineProperty(e.prototype,"inputEnabled",{set:function(t){this._inputEnabled=t,this._inputEnabled?this._addInput():this._removeInput()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){return this._interactiveBacking&&this._interactiveBacking.inputEnabled?this._interactiveBacking.events:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"input",{get:function(){return this._interactiveBacking.input},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hSize",{get:function(){return this.__width},set:function(t){this.__width=t,this._setSize()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vSize",{get:function(){return this.__height},set:function(t){this.__height=t,this._setSize()},enumerable:!0,configurable:!0}),e.prototype.setSize=function(t,e){this.__width=t,this.__height=e,this._setSize()},e}(h),t("NineSliceImage",c),d=function(t){function e(e,i,r,s,h,u,l,c,d){void 0===e&&(e=""),void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===h&&(h=0),void 0===u&&(u="default"),void 0===l&&(l=""),void 0===c&&(c=0),void 0===d&&(d=0),t.call(this,i,r,null,null,"spine_"+e),this.assetName=e,this.skin=u,this.anim=l,this.hOffset=c,this.vOffset=d,this.debug=!1,this.onAnimationComplete=new Phaser.Signal,this.img=null,this.frameAnimations={},this.frameAnimationKeys=[],this._bounds=new PIXI.Rectangle,this._canUpdate=!1,this._paused=!1,this._speed=1,this._fps=0;var p=e+".json",f=e+".atlas",_=e+".png";0===s&&(s=this.game.width),0===h&&(h=this.game.height),this.sWidth=s,this.sHeight=h,this.spine_data=(new n.Data).load(this.game.cache.getJSON(p)),this.spineAnimations=this.spine_data.anim_keys,this.atlas_data=(new o.Data).importAtlasText(this.game.cache.getText(f)),this.images={},this.images[_]=this.game.cache.getImage(_),this.spine_pose=new n.Pose(this.spine_data),this.spine_pose.setSkin(u),this.animation=l,this.spine_pose.onComplete.add(this._onAnimationComplete,this),this.bmd=this.game.add.bitmapData(s,h),this.render_ctx2d=new a.RenderCtx2D(this.bmd.ctx),this.render_ctx2d.loadData(this.spine_data,this.atlas_data,this.images),this.loadTexture(this.bmd),this.speed=1,this._canUpdate=!0}return __extends(e,t),e.prototype.destroy=function(){this.game.renderType===Phaser.WEBGL?(this.render_webgl.dropData(this.spine_data,this.atlas_data),delete this.render_webgl):this.game.renderType===Phaser.CANVAS?(this.render_ctx2d.dropData(this.spine_data,this.atlas_data),delete this.render_ctx2d):console.log("TODO"),delete this.spine_data,delete this.spine_pose,delete this.images,t.prototype.destroy.call(this)},e.prototype.update=function(){this._canUpdate&&(this._paused||(this.render(),this.spine_pose.update(this._fps)))},e.prototype.render=function(){this.spine_pose.strike(),this.frameAnimationKeys.forEach(this._updateFrameAnimationByName,this),this.bmd.ctx.save(),this.bmd.ctx.clearRect(0,0,this.bmd.width,this.bmd.height),this.bmd.ctx.translate(this.hOffset,this.vOffset+this.bmd.height),this.bmd.ctx.scale(1,-1),this.bmd.ctx.globalAlpha=this.worldAlpha,this.render_ctx2d.drawPose(this.spine_pose,this.atlas_data),this.bmd.ctx.restore(),this.bmd.dirty=!0},e.prototype.debugDraw=function(){this.debug&&this.game.renderType===Phaser.CANVAS&&this.render_ctx2d.drawDebugPose(this.spine_pose,this.atlas_data)},e.prototype.nextAnimation=function(){var t=this.animation,e=this.spineAnimations.indexOf(t);e++,e===this.spineAnimations.length&&(e=0),this.animation=this.spineAnimations[e]},e.prototype._onAnimationComplete=function(){this.onAnimationComplete.dispatch(this.spine_pose.curAnim().name)},e.prototype._updateFrameAnimationByName=function(t){this._updateFrameAnimation(this.frameAnimations[t])},e.prototype._updateFrameAnimation=function(t){var e=t.sprite,i=this.spine_pose.bones[t.boneName],n=i.local_space.position.x+t.props.x,o=i.local_space.position.y+t.props.y,a=i.local_space.rotation.deg+t.props.angle,r=i.local_space.scale;if(void 0!==i.parent_key)for(;i&&void 0!==i&&void 0!==i.parent_key&&(i=this.spine_pose.bones[i.parent_key],void 0!==i);)n+=i.local_space.position.x,o+=i.local_space.position.y,a+=i.local_space.rotation.deg,r.x*=i.local_space.scale.x,r.y*=i.local_space.scale.y;e.x=n,e.y=o,e.angle=a,e.scale.x=r.x,e.scale.y=r.y},Object.defineProperty(e.prototype,"skeleton",{get:function(){return this.spine_data.skeleton},enumerable:!0,configurable:!0}),e.prototype.addFrameAnimation=function(t,e,i,n){this.addChild(e),void 0===n&&(n={}),void 0===n.x&&(n.x=0),void 0===n.y&&(n.y=0),void 0===n.angle&&(n.angle=0),this.frameAnimations[t]={sprite:e,boneName:i,props:n},this.frameAnimationKeys=Object.keys(this.frameAnimations)},e.prototype.getFrameAnimation=function(t){return void 0===this.frameAnimations[t]?null:this.frameAnimations[t].sprite},Object.defineProperty(e.prototype,"animation",{get:function(){return void 0===this.spine_pose.curAnim()?null:this.spine_pose.curAnim().name},set:function(t){return this.animation&&this.spine_pose.setTime(0),void 0===this.spine_data.anims[t]?void console.log("there is no animation:",t):void this.spine_pose.setAnim(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paused",{set:function(t){this._paused=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t,this._fps=1e3/60*this._speed},enumerable:!0,configurable:!0}),e}(r),t("Spine",d)}}}),System.register("dijon/utils",["dijon/application","dijon/display"],function(t,e){"use strict";var i,n,o,a,r,s,h,u;e&&e.id;return{setters:[function(t){i=t},function(t){n=t}],execute:function(){o=function(){function t(){}return t.isNumber=function(t){return+t===+t},t}(),t("Util",o),a=function(){function t(){}return t.log=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];return t.enabled?(e&&e.constructor&&i.unshift(e.constructor.toString().match(/\w+/g)[1]+" ::"),console.log.apply(console,i)):void 0},t.enabled=!0,t}(),t("Logger",a),r=function(){function t(){}return Object.defineProperty(t,"mobile",{get:function(){return t.mobileOS!==t.UNKNOWN},enumerable:!0,configurable:!0}),Object.defineProperty(t,"cocoon",{get:function(){return"undefined"!=typeof navigator.isCocoonJS},enumerable:!0,configurable:!0}),Object.defineProperty(t,"mobileOS",{get:function(){var e=window.navigator.userAgent||window.navigator.vendor||window.opera;return e.match(/iPad/i)||e.match(/iPhone/i)||e.match(/iPod/i)?t.IOS:e.match(/Android/i)?t.ANDROID:t.UNKNOWN},enumerable:!0,configurable:!0}),Object.defineProperty(t,"browser",{get:function(){var t=navigator.userAgent.toLowerCase();return{firefox:t.indexOf("firefox")>-1,ie:t.indexOf("ie")>-1,safari:t.indexOf("safari")>-1,chrome:t.indexOf("chrome")>-1}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"pixelRatio",{get:function(){return void 0!==typeof window.devicePixelRatio?window.devicePixelRatio:1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"customPixelRatio",{get:function(){return t.pixelRatio>=1.5?2:1},enumerable:!0,configurable:!0}),t.IOS="iOS",t.ANDROID="android",t.UNKNOWN="unknown",t}(),t("Device",r),s=function(){function t(){}return Object.defineProperty(t,"game",{get:function(){return i.Application.getInstance().game},enumerable:!0,configurable:!0}),t.rect=function(e,i,n,o,a,r,s,h,u){void 0===e&&(e=100),void 0===i&&(i=100),void 0===n&&(n=16777215),void 0===o&&(o=1),void 0===a&&(a=!0),void 0===r&&(r=16777215),void 0===s&&(s=1),void 0===h&&(h=1),void 0===u&&(u=!1);var l=t.game.add.graphics(0,0);a&&l.beginFill(n,o),u&&(l.lineWidth=s,l.lineStyle(s,r,h)),l.drawRect(0,0,e,i);var c=l.generateTexture();return t.game.world.remove(l),c},t.roundedRect=function(e,i,n,o,a,r,s,h,u,l){void 0===e&&(e=100),void 0===i&&(i=100),void 0===n&&(n=10),void 0===o&&(o=16777215),void 0===a&&(a=1),void 0===r&&(r=!0),void 0===s&&(s=16777215),void 0===h&&(h=1),void 0===u&&(u=1),void 0===l&&(l=!1);var c=t.game.add.graphics(0,0);r&&c.beginFill(o,a),l&&(c.lineWidth=h,c.lineStyle(h,s,u)),c.drawRoundedRect(0,0,e,i,n);var d=c.generateTexture();return t.game.world.remove(c),d},t.square=function(e,i,n,o,a,r,s,h){return void 0===e&&(e=100),void 0===i&&(i=16777215),void 0===n&&(n=1),void 0===o&&(o=!0),void 0===a&&(a=16777215),void 0===r&&(r=1),void 0===s&&(s=1),void 0===h&&(h=!1),t.rect(e,e,i,n,o,a,r,s,h)},t.circle=function(e,i,n,o,a,r,s,h){void 0===e&&(e=100),void 0===i&&(i=16777215),void 0===n&&(n=1),void 0===o&&(o=!0),void 0===a&&(a=16777215),void 0===r&&(r=1),void 0===s&&(s=1),void 0===h&&(h=!1);var u=t.game.add.graphics(0,0);o&&u.beginFill(i,n),h&&(u.lineWidth=r,u.lineStyle(r,a,s)),u.drawCircle(0,0,e);var l=u.generateTexture();return t.game.world.remove(u),l},t.ellipse=function(e,i,n,o,a,r,s,h,u){void 0===e&&(e=50),void 0===i&&(i=100),void 0===n&&(n=16777215),void 0===o&&(o=1),void 0===a&&(a=!0),void 0===r&&(r=16777215),void 0===s&&(s=1),void 0===h&&(h=1),void 0===u&&(u=!1);var l=t.game.add.graphics(0,0);a&&l.beginFill(n,o),u&&(l.lineWidth=s,l.lineStyle(s,r,h)),l.drawEllipse(0,0,.5*e,.5*i);var c=l.generateTexture();return t.game.world.remove(l),c},t}(),t("Textures",s),h=function(){function t(){}return Object.defineProperty(t,"game",{get:function(){return i.Application.getInstance().game},enumerable:!0,configurable:!0}),t.image=function(e,i,n,o){void 0===e&&(e=0),void 0===i&&(i=0),void 0===o&&(o="");var a=new Phaser.Image(t.game,e,i,n);return a.name=o,a},t.button=function(e,i,o,a,r,h,u,l,c,d,p){void 0===e&&(e=0),void 0===i&&(i=0),void 0===o&&(o=100),void 0===a&&(a=50),void 0===r&&(r=!1),void 0===h&&(h="button"),void 0===u&&(u=null),void 0===l&&(l=null),void 0===c&&(c=16777215),void 0===d&&(d=16711680),void 0===p&&(p=65280);var f=new Phaser.Sprite(t.game,e,i),_=new n.Text(.5*o,.55*a," "+h+" ","Arial",r?25:.6*a,"#000000");_.centerPivot(),_.name="Label",r&&(o=_.width+10,a=_.height+10,_.position.set(.5*o,.55*a));var m=t.image(0,0,s.roundedRect(o,a,10,c),"Up"),g=t.image(0,0,s.roundedRect(o,a,10,d),"Over"),y=t.image(0,0,s.roundedRect(o,a,10,p),"Down");return g.visible=!1,y.visible=!1,f.addChild(m),f.addChild(g),f.addChild(y),f.addChild(_),f.inputEnabled=!0,f.input.useHandCursor=!0,f.events.onInputUp.add(function(){y.visible=!1,g.visible=!1,m.visible=!0,u&&u.call(l)}),f.events.onInputDown.add(function(){y.visible=!0,g.visible=!1,m.visible=!1}),f.events.onInputOver.add(function(){y.visible=!1,g.visible=!0,m.visible=!1}),f.events.onInputOut.add(function(){y.visible=!1,g.visible=!1,m.visible=!0}),f.getBounds=function(){return new PIXI.Rectangle(0,0,m.width,m.height)},f},t}(),t("Placeholders",h),u=function(){function t(){}return t.ASSET_MANAGER_DATA_SET="dijonAssetManagerDataSet",t.ASSET_MANAGER_ASSETS_CLEARED="dijonAssetManagerAssetsCleared",t.MOUSE_LEAVE_GLOBAL="mouseOutGlobal",t.MOUSE_ENTER_GLOBAL="mouseEnterGlobal",t}(),t("Notifications",u)}}}),System.register("dijon/core",["dijon/application","dijon/utils","dijon/display"],function(t,e){"use strict";var i,n,o,a,r,s,h,u,l,c,d,p,f;e&&e.id;return{setters:[function(t){i=t},function(t){n=t},function(t){o=t}],execute:function(){a=function(){function t(t,e){void 0===t&&(t=!0),void 0===e&&(e=null),this.enabled=t,this.category=e}return t.prototype.trackEvent=function(t,e,i){if(void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),this.active&&this.enabled){if(!t)throw new r("No action defined");i?this.ga("send","event",this.category,t,e,i):e?this.ga("send","event",this.category,t,e):this.ga("send","event",this.category,t)}},t.prototype.trackOmnitureEvent=function(t,e,i){return this.enabled?"undefined"==typeof window.trackFlashEvent?!1:void window.trackFlashEvent(t,e,i):void 0},Object.defineProperty(t.prototype,"active",{get:function(){return window.ga?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ga",{get:function(){return window.ga},enumerable:!0,configurable:!0}),t}(),t("AnalyticsManager",a),r=function(){function t(t){this.message=t,this.name="AnalyticsException"}return t}(),t("AnalyticsException",r),s=function(){function t(){this._data={},this._baseURL="",this._pathObj={},this._assetPath=null,this._dataPath=null,this._spriteSheetPath=null,this._imgPath=null,this._spinePath=null,this._fontPath=null,this._bitmapFontPath=null,this._physicsPath=null,this._audioSpritePath=null,this._soundPath=null,this._soundDecodingModifier=2,this._res=1,this._resolution=null,this._loadData={},this._autoLoadData={},this._completedLoads={},this._requiredData={},this._currentAssetList=null,this._hasFiles=!1,this._soundsToDecode=[],this._isLoadingQueue=!1,this._fileCompleteProgress=0,this._maxPercent=100,this._numSounds=0,this._soundsDecoded=0,this._cacheBustVersion="",this.onLoadStart=new Phaser.Signal,this.onFileStart=new Phaser.Signal,this.onFileComplete=new Phaser.Signal,this.onLoadComplete=new Phaser.Signal,this.onLoadCompleteAndAudioDecoded=new Phaser.Signal,this.onBackgroundLoadStart=new Phaser.Signal,this.onBackgroundFileStart=new Phaser.Signal,this.onBackgroundFileComplete=new Phaser.Signal,this.onBackgroundLoadComplete=new Phaser.Signal,this.onBackgroundLoadCompleteAndAudioDecoded=new Phaser.Signal,this._init()}return t.prototype._init=function(){this.app=i.Application.getInstance(),this.game=this.app.game,this.baseURL="",this.paths=null,this.resolution=this.game.resolution},t.prototype._parseAssetList=function(t,e){var i=this;this._autoLoadData[t]=e.autoload,this._requiredData[t]=e.required,this._loadData[t]=[],e.assets.forEach(function(e){i._loadData[t].push(e)})},t.prototype._loadAssets=function(t){
var e,i=this._loadData[t];for(e=0;e<i.length;e++)this._loadAsset(i[e])},t.prototype._backgroundLoadStart=function(){this.onBackgroundLoadStart.dispatch()},t.prototype._backgroundFileComplete=function(t,e,i,n){this.game.cache.checkKey(Phaser.Cache.IMAGE,e)&&this._setBaseTextureResolution(this.game.cache.getPixiBaseTexture(e)),this._fileCompleteProgress=t,this.onBackgroundFileComplete.dispatch(t,e,i,n)},t.prototype._backgroundLoadComplete=function(){this.game.load.onFileComplete.remove(this._backgroundFileComplete,this),this.onBackgroundLoadComplete.dispatch(),this._checkSoundDecoding(this.onBackgroundLoadCompleteAndAudioDecoded)},t.prototype._gameLoadStart=function(){this.onLoadStart.dispatch()},t.prototype._gameFileStart=function(){this.onFileStart.dispatch()},t.prototype._gameFileComplete=function(t,e,i,n){this.game.cache.checkKey(Phaser.Cache.IMAGE,e)&&this._setBaseTextureResolution(this.game.cache.getPixiBaseTexture(e)),this._fileCompleteProgress=t,this.onFileComplete.dispatch(this.getLoadProgress(),e,i,n)},t.prototype._setBaseTextureResolution=function(t){t&&t.source.src.indexOf("@"+this.resolution+"x")>=0&&(t.resolution=this.resolution)},t.prototype._gameLoadComplete=function(){this._completedLoads[this._currentAssetList]=!0,this.onLoadComplete.dispatch(),this.game.load.onFileStart.remove(this._gameFileStart,this),this.game.load.onFileComplete.remove(this._gameFileComplete,this),this._checkSoundDecoding(this.onLoadCompleteAndAudioDecoded)},t.prototype._checkSoundDecoding=function(t){var e,i,n;if(this._soundsToDecode&&this._soundsToDecode.length>0)for(i=0;i<this._soundsToDecode.length;i++)n=this._soundsToDecode[i].isAudioSprite,e=this.game.add.sound(this._soundsToDecode[i].url),e.__isAudioSprite=n,e.eventToDispatch=t,e.onDecoded.addOnce(this._onSoundDecoded,this);else t.dispatch()},t.prototype._onSoundDecoded=function(t){var e=this._soundsToDecode.indexOf(t.key);this._soundsToDecode.splice(e,1),"undefined"!=typeof this.game.audio&&"undefined"!=typeof this.game.audio.addAudio&&(t.__isAudioSprite&&this.game.add.audioSprite(t.key),this.game.audio.addAudio(t.key,t.__isAudioSprite)),this._soundsDecoded++,this._maxPercent=100-this._numSounds*this.soundDecodingModifier+this._soundsDecoded*this.soundDecodingModifier,this._gameFileComplete(100),0===this._soundsToDecode.length&&t.eventToDispatch.dispatch()},t.prototype._getAssetKey=function(t){if(t.indexOf(".")<0)return t;var e=t.split(".");return e.pop(),e.join("")},t.prototype._getExtension=function(t){return t.split(".").pop()},t.prototype._getResolution=function(e){var i="";return"string"==typeof e&&(e=parseFloat(e)),void 0===e&&(e=this.resolution),e>1.5&&(i=t.RESOLUTION_2X),i},t.prototype._loadAsset=function(e){var i=e.type,n=e.url||e.key;switch(i){case t.ASSET_LIST:this._loadAssets(e.id);break;case t.SOUND:this.loadSound(n,e.extensions);break;case t.AUDIO_SPRITE:this.loadAudioSprite(n,e.extensions);break;case t.IMAGE:this.loadImage(n,this._getResolution(e.resolution));break;case t.ATLAS:this.loadAtlas(n,this._getResolution(e.resolution));break;case t.TEXT:this.loadText(n);break;case t.JSON:this.loadJSON(n);break;case t.TILEMAP:this.loadTilemap(n);break;case t.TILEDMAP:this.loadTiledmap(n,e.assets);break;case t.PHYSICS:this.loadPhysics(n);break;case t.SPINE:this.loadSpine(n,this._getResolution(e.resolution))}},t.prototype._parseData=function(){var t;for(t in this._data)this._parseAssetList(t,this._data[t])},t.prototype._getCacheBustedUrl=function(t){return void 0===this._cacheBustVersion||""===this._cacheBustVersion?t:t+"?v="+this._cacheBustVersion},t.prototype.loadText=function(t){var e=this._getAssetKey(t);return this.game.load.text(e,this._getCacheBustedUrl(this._dataPath+"/"+t))},t.prototype.loadJSON=function(t){return t=this._getAssetKey(t),this.game.load.json(t,this._getCacheBustedUrl(this._dataPath+"/"+t+".json"))},t.prototype.loadTilemap=function(t){return t=this._getAssetKey(t),this.game.load.tilemap(t,this._getCacheBustedUrl(this._dataPath+"/tilemap/"+t+".json"),null,Phaser.Tilemap.TILED_JSON)},t.prototype.loadTiledmap=function(e,i){var n=this;if(void 0===Phaser.Plugin.Tiled)return console.log("tiledmap requires the phaser-tiled plugin from https://github.com/englercj/phaser-tiled"),null;var o=Phaser.Plugin.Tiled.utils.cacheKey;this.game.load.tiledmap(o(e,"tiledmap"),this._getCacheBustedUrl(this._dataPath+"/tilemap/"+e+".json"),null,Phaser.Tilemap.TILED_JSON),i.forEach(function(i){switch(i.type){case t.TILEDMAP_TILESET:case t.TILEDMAP_LAYER:n.loadTiledmapImage(e,i.type,i)}})},t.prototype.loadTiledmapImage=function(t,e,i){var n=Phaser.Plugin.Tiled.utils.cacheKey,o="",a=this._getAssetKey(i.url),r=n(t,"tileset",a);"string"!=typeof i.resolution&&(o=this._getResolution(i.resolution));var s=this._getAssetKey(a+o+"."+this._getExtension(i.url));console.log(i.url,r),this.game.load.image(r,this._getCacheBustedUrl(this._spriteSheetPath+"/"+s+".png"))},t.prototype.loadPhysics=function(t){return t=this._getAssetKey(t),this.game.load.physics(t,this._getCacheBustedUrl(this._physicsPath+"/"+t+".json"))},t.prototype.loadAtlas=function(t,e){return"string"!=typeof e&&(e=this._getResolution(e)),this.game.cache.checkImageKey(t)?t:this.game.load.atlasJSONHash(t,this._getCacheBustedUrl(this._spriteSheetPath+"/"+t+e+".png"),this._getCacheBustedUrl(this._spriteSheetPath+"/"+t+e+".json"))},t.prototype.loadImage=function(t,e){"string"!=typeof e&&(e=this._getResolution(e));var i=this._getAssetKey(t);return this.game.cache.checkImageKey(i)?i:(t=i+e+"."+this._getExtension(t),this.game.load.image(i,this._getCacheBustedUrl(this._imgPath+"/"+t)))},t.prototype.loadSpine=function(t,e){"string"!=typeof e&&(e=this._getResolution(e));var i=this._getAssetKey(t);if(this.game.cache.checkImageKey(i))return i;t=i+e+".png";var n=i+".json",o=i+".atlas";this.game.load.json(i+".json",this._getCacheBustedUrl(this._spinePath+"/"+n)),this.game.load.text(i+".atlas",this._getCacheBustedUrl(this._spinePath+"/"+o)),this.game.load.image(i+".png",this._getCacheBustedUrl(this._spinePath+"/"+t))},t.prototype.loadBitmapFont=function(t,e){"string"!=typeof e&&(e=this._getResolution(e)),this.game.load.bitmapFont(t,this._getCacheBustedUrl(this._bitmapFontPath+"/"+t+e+".png"),this._getCacheBustedUrl(this._bitmapFontPath+"/"+t+e+".json"))},t.prototype.loadAudio=function(t,e,i){var n,o;if(!this.game.cache.checkSoundKey(t)||!this.game.cache.getSound(t).isDecoded){if("undefined"==typeof n&&(n="sound"),e.indexOf(",")>=0&&(e=e.split(",")),this.game.device.iOS&&-1===e.indexOf("m4a")&&e.unshift("m4a"),"object"==typeof e){o=[];for(var a=0;a<e.length;a++)o.push(this._getCacheBustedUrl((i?this._audioSpritePath:this._soundPath)+"/"+t+"."+e[a]))}else o=this._getCacheBustedUrl((i?this._audioSpritePath:this._soundPath)+"/"+n+"/"+t+"."+e);i?this.game.load.audiosprite(t,o,this._audioSpritePath+"/"+t+".json"):this.game.load.audio(t,o),this._soundsToDecode.push({url:t,isAudioSprite:i})}},t.prototype.loadSound=function(t,e){return this.loadAudio(t,e,!1)},t.prototype.loadAudioSprite=function(t,e){return this.loadAudio(t,e,!0)},t.prototype.loadAssets=function(t,e){if(void 0===e&&(e=!1),this._currentAssetList=t,this.game.load.onFileComplete.remove(this._backgroundFileComplete,this),this.game.load.onFileComplete.remove(this._gameFileComplete,this),this._hasFiles=!1,this._soundsToDecode=[],"undefined"!=typeof this._data){if("undefined"==typeof this._data[t]||this._data[t].length<1)return console.log("no preload data registered for ",t);if(this._loadAssets(t),this._hasFiles=this.game.load.totalQueuedFiles()>0,e?(this.game.load.onLoadStart.addOnce(this._backgroundLoadStart,this),this.game.load.onFileComplete.add(this._backgroundFileComplete,this),this.game.load.onLoadComplete.addOnce(this._backgroundLoadComplete,this)):(this.game.load.onLoadStart.addOnce(this._gameLoadStart,this),this.game.load.onFileStart.add(this._gameFileStart,this),this.game.load.onFileComplete.add(this._gameFileComplete,this),this.game.load.onLoadComplete.addOnce(this._gameLoadComplete,this)),!this._hasFiles)return this._gameLoadStart(),this._gameFileComplete(100),void this._gameLoadComplete();this._numSounds=this._soundsToDecode.length,this._soundsDecoded=0,this._maxPercent=100-this._numSounds*this.soundDecodingModifier,e&&this.game.load.start()}},t.prototype.loadQueue=function(){if(!this._isLoadingQueue){if("undefined"==typeof this._data)return console.log("no preload queue to load");var t,e,i;for(e in this._data)if(this._autoLoadData[e])for(t=this._data[e],i=0;i<t.length;i++)this._loadAsset(t[i]);this.game.load.start(),this._isLoadingQueue=!0,this.game.load.onLoadStart.addOnce(this._backgroundLoadStart,this),this.game.load.onFileComplete.add(this._backgroundFileComplete,this),this.game.load.onLoadComplete.addOnce(this._backgroundLoadComplete,this)}},t.prototype.getLoadProgress=function(){var t=this._fileCompleteProgress*this._maxPercent/100;return t},t.prototype.allSoundsDecoded=function(){return 0===this._soundsToDecode.length},t.prototype.setData=function(t){this._data=t,this._loadData={},this._parseData(),this.sendNotification(n.Notifications.ASSET_MANAGER_DATA_SET,this._data)},t.prototype.clearAssets=function(t,e,i,o,a,r){void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===o&&(o=!0),void 0===a&&(a=!0),void 0===r&&(r=!0);var s=this._data[t];if(console.log("clearing: ",t),!s||"undefined"==typeof s||s.length<1)return console.log("no assets",s);for(var h=0;h<s.length;h++)this.clearAsset(s[h],e,i,o,a,r);this._completedLoads[t]=!1,this.sendNotification(n.Notifications.ASSET_MANAGER_ASSETS_CLEARED,t)},t.prototype.clearAsset=function(e,i,n,o,a,r){void 0===i&&(i=!0),void 0===n&&(n=!0),void 0===o&&(o=!0),void 0===a&&(a=!0),void 0===r&&(r=!0);var s=e.type,h=e.url,u=e.required;if(u)return void console.log("the "+s+" asset: "+h+" is required and will not be cleared");switch(s){case t.AUDIO:i&&(this.game.sound.removeByKey(h),this.game.cache.removeSound(h));break;case t.IMAGE:o&&(this.game.cache.removeImage(h),PIXI.BaseTextureCache[h].destroy());break;case t.ATLAS:n&&(this.game.cache.removeImage(h),PIXI.BaseTextureCache[h].destroy(),this.game.cache.removeXML(h));break;case t.TEXT:a&&this.game.cache.removeText(h);break;case t.JSON:r&&this.game.cache.removeJSON(h);break;case t.PHYSICS:r&&this.game.cache.removePhysics(h)}},t.prototype.hasLoadedAssets=function(t){return this._completedLoads[t]===!0},t.prototype.sendNotification=function(t,e){return this.app.sendNotification(t,e)},Object.defineProperty(t.prototype,"baseURL",{set:function(t){t&&void 0!==t&&"/"!==t.charAt(t.length-1)&&(t+="/"),this._baseURL=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paths",{set:function(t){this._pathObj=t||{},this._assetPath=this._baseURL+(this._pathObj.assetPath||"assets"),this._dataPath=this._baseURL+(this._pathObj.dataPath||"assets/data"),this._spriteSheetPath=this._baseURL+(this._pathObj.spritesheetPath||"assets/img/spritesheets"),this._imgPath=this._baseURL+(this._pathObj.imgPath||"assets/img"),this._spinePath=this._baseURL+(this._pathObj.spinePath||"assets/spine"),this._fontPath=this._baseURL+(this._pathObj.fontPath||"assets/fonts"),this._bitmapFontPath=this._baseURL+(this._pathObj.bitmapFontPath||"assets/fonts/bitmap"),this._audioSpritePath=this._baseURL+(this._pathObj.audioSpritePath||"assets/audio/sprite"),this._soundPath=this._baseURL+(this._pathObj.soundPath||"assets/audio/sound"),this._physicsPath=this._baseURL+(this._pathObj.physicsPath||"assets/data/physics")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resolution",{get:function(){return this._res},set:function(e){void 0===e&&(e=this.game.resolution),this._res=e,this._resolution="",this._res>1.5&&(this._resolution=t.RESOLUTION_2X)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"soundDecodingModifier",{get:function(){return this._soundDecodingModifier},set:function(t){void 0===t&&(t=2),this._soundDecodingModifier=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cacheBustVersion",{set:function(t){this._cacheBustVersion=""+t},enumerable:!0,configurable:!0}),t.AUDIO="audio",t.SOUND="sound",t.AUDIO_SPRITE="audioSprite",t.IMAGE="image",t.ATLAS="atlas",t.TEXT="text",t.JSON="json",t.TILEMAP="tilemap",t.TILEDMAP="tiledmap",t.TILEDMAP_TILESET="tileset",t.TILEDMAP_LAYER="layer",t.PHYSICS="physics",t.SPINE="spine",t.ASSET_LIST="assetList",t.RESOLUTION_2X="@2x",t.RESOLUTION_3X="@3x",t}(),t("AssetManager",s),h=function(){function t(){this._defaultVolume=1,this._sprites={},this._sounds={},this._markerLookup={},this.game=i.Application.getInstance().game}return t.prototype._addAudio=function(t,e){return void 0===e&&(e=!1),e===!0?this._parseAudioSprite(t,this.game.add.audioSprite(t)):this._allowMultiple(this.game.add.sound(t))},t.prototype._parseAudioSprite=function(t,e){for(var i in e.sounds)this._allowMultiple(e.sounds[i]),this._markerLookup[i]=t;return e},t.prototype._allowMultiple=function(t){return t.allowMultiple=!0,t},t.prototype._getKeyFromMarkerName=function(t){if("undefined"!=typeof this._markerLookup[t])return this._markerLookup[t];for(var e in this._sprites)if("undefined"!=typeof this._sprites[e].sounds[t])return this._markerLookup[t]=e,e;return!1},t.prototype._playSpriteMarker=function(t,e,i,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!0),"undefined"!=typeof i?"string"==typeof i&&(i=i.indexOf("+")>=0||i.indexOf("-")>=0?this._defaultVolume+parseFloat(i):parseFloat(i)):i=this._defaultVolume,n=n||!1,o=o===!1?!1:!0,this._sprites[t].play(e,i)},t.prototype._stopSpriteMarker=function(t,e){return"undefined"==typeof this._sprites||"undefined"==typeof this._sprites[t]?!1:this._sprites[t].stop(e)},t.prototype._stopSound=function(t){return t.stop()},t.prototype.addAudio=function(t,e){return void 0===e&&(e=!1),e===!0?this.addAudioSprite(t):this.addSound(t)},t.prototype.addSound=function(t){return"undefined"!=typeof this._sounds[t]?this._sounds[t]:(this._sounds[t]=this.game.add.audio(t),this._sounds[t].allowMultiple=!0,this._sounds[t])},t.prototype.addAudioSprite=function(t){return"undefined"!=typeof this._sprites[t]?this._sprites[t]:(this._sprites[t]=this._addAudio(t,!0),this._sprites[t])},t.prototype.playAudio=function(t,e,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!0),this._getKeyFromMarkerName(t)?this.playSpriteMarker(t,e,i,n):this.playSound(t,e,i,n)},t.prototype.playDelayedAudio=function(t,e,i,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!0),this._getKeyFromMarkerName(e)?this.playDelayedSpriteMarker(t,e,i,n,o):this.playDelayedSound(t,e,i,n,o)},t.prototype.playSound=function(t,e,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!0),"undefined"==typeof this._sounds[t]?null:(e="undefined"==typeof e?this._defaultVolume:e,this._sounds[t].play("",0,e,i,n))},t.prototype.playSpriteMarker=function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=!0);var o=this._getKeyFromMarkerName(t);return o?this._playSpriteMarker(o,t,e,i,n):(console.log("marker not found",t),null)},t.prototype.playDelayedSound=function(t,e,i,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!0),this.game.time.events.add(t,this.playSound,this,e,i,n,o),null},t.prototype.playDelayedSpriteMarker=function(t,e,i,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!0),this.game.time.events.add(t,this.playSpriteMarker,this,e,i,n,o),null},t.prototype.stopAudio=function(t){return this._getKeyFromMarkerName(t)?this.stopSpriteMarker(t):this.stopSound(t)},t.prototype.stopSound=function(t){return"undefined"!=typeof this._sounds&&"undefined"!=typeof this._sounds[t]?this._sounds[t].stop():void 0},t.prototype.stopSpriteMarker=function(t){var e=this._getKeyFromMarkerName(t);return e?void this._stopSpriteMarker(e,t):void console.log("marker not found",t)},t.prototype.removeSound=function(t){return"undefined"==typeof this._sounds||"undefined"==typeof this._sounds[t]?!1:void(this._sounds[t]&&(this.stopSound(t),this._sounds[t].destroy(),delete this._sounds[t]))},t.prototype.removeSprite=function(t){"undefined"!=typeof this._sprites&&"undefined"!=typeof this._sprites[t]&&(this.stopSpriteMarker(t),this._sprites[t]=null,delete this._sprites[t])},t.prototype.fade=function(t,e,i,n){return void 0===n&&(n=!1),t?(t.fadeTween&&t.fadeTween&&this.game.tweens.remove(t.fadeTween),t.fadeTween=this.game.add.tween(t).to({volume:e},i||300,Phaser.Easing.Linear.None),n===!0&&t.fadeTween.onComplete.addOnce(function(){this._stopSound(t)},this),t.fadeTween.start()):void 0},Object.defineProperty(t.prototype,"defaultVolume",{get:function(){return this._defaultVolume},set:function(t){this._defaultVolume=t},enumerable:!0,configurable:!0}),t}(),t("AudioManager",h),u=function(t){function e(e){t.call(this,e),this.onWorldInputDisabled=new Phaser.Signal,this.onWorldInputEnabled=new Phaser.Signal}return __extends(e,t),e.prototype.boot=function(){t.prototype.boot.call(this),this.app=i.Application.getInstance(),this.asset=new s,this.sequence=new c,this.transition=new f,this.storage=new p,this.audio=new h,this.analytics=new a(this.config.analytics),this.add=null,this.add=new l(this),this.addLayers(),this.addMouseCallbacks(),this.setFactoryDefaultLayer(this.gameLayer)},e.prototype.addPlugins=function(){var t=this;this.config.plugins&&this.config.plugins.length>0&&this.config.plugins.forEach(function(e){"function"==typeof Phaser.Plugin[e]&&t.add.plugin(Phaser.Plugin[e])})},e.prototype.setFactoryDefaultLayer=function(t){this.add.setDefaultLayer(t||this.world)},e.prototype.addLayers=function(){this.backgroundLayer=this.add.dGroup(0,0,"_background_layer",!0),this.stage.setChildIndex(this.backgroundLayer,0),this.gameLayer=this.add.dGroup(0,0,"_game_layer"),this.uiLayer=this.add.dGroup(0,0,"_ui_layer"),this.uiLayer.fixedToCamera=!0,this.stageLayer=this.add.dGroup(0,0,"_stage_layer",!0)},e.prototype.addMouseCallbacks=function(){this.device.desktop&&(this.input.mouse.mouseOverCallback=this.mouseOver,this.input.mouse.mouseOutCallback=this.mouseOut)},e.prototype.mouseOut=function(){i.Application.getInstance().sendNotification(n.Notifications.MOUSE_LEAVE_GLOBAL)},e.prototype.mouseOver=function(){i.Application.getInstance().sendNotification(n.Notifications.MOUSE_ENTER_GLOBAL)},e.prototype.disableElementInput=function(t){if(t.input&&t.inputEnabled===!0&&(t.wasEnabled=!0,t.inputEnabled=!1),t.children.length>0)for(var e=0;e<t.children.length;e++)this.disableElementInput(t.children[e])},e.prototype.enableElementInput=function(t){if(t.input&&t.inputEnabled===!1&&t.wasEnabled&&(t.wasEnabled=!1,t.inputEnabled=!0),t.children.length>0)for(var e=0;e<t.children.length;e++)this.enableElementInput(t.children[e])},e.prototype.disableInput=function(t){return t.forEach(function(t){return t instanceof Phaser.Group?this.disableInput(t):this.disableElementInput(t)},this)},e.prototype.enableInput=function(t){return t.forEach(function(t){return t instanceof Phaser.Group?this.enableInput(t):this.enableElementInput(t)},this)},e.prototype.disableGameInput=function(){this.disableInput(this.gameLayer),this.onWorldInputDisabled.dispatch()},e.prototype.enableGameInput=function(){this.enableInput(this.gameLayer),this.onWorldInputEnabled.dispatch()},e.prototype.changeState=function(t){return this.gameLayer.removeAll(!0,!0),this.state.start(t,!1,!1)},Object.defineProperty(e.prototype,"addToGame",{get:function(){return this.add.targetGroup=this.gameLayer,this.add},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"addToBackground",{get:function(){return this.add.targetGroup=this.backgroundLayer,this.add},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"addToUI",{get:function(){return this.add.targetGroup=this.uiLayer,this.add},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"addToStage",{get:function(){return this.add.targetGroup=this.stageLayer,this.add},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"addToWorld",{get:function(){return this.add.targetGroup=this.world,this.add},enumerable:!0,configurable:!0}),e}(Phaser.Game),t("Game",u),l=function(t){function e(){t.apply(this,arguments),this._targetGroup=null,this._defaultLayer=this.world}return __extends(e,t),e.prototype.existing=function(t){var e=this.targetGroup;return this.targetGroup=null,e.add(t)},e.prototype.image=function(t,e,i,n,o){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=this.targetGroup),this.targetGroup=null,o.add(new Phaser.Image(this.game,t,e,i,n))},e.prototype.sprite=function(t,e,i,n,o){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=this.targetGroup),this.targetGroup=null,o.create(t,e,i,n)},e.prototype.creature=function(t,e,i,n,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=this.targetGroup),this.targetGroup=null;var a=new Phaser.Creature(this.game,t,e,i,n);return o.add(a),a},e.prototype.group=function(t,e,i,n,o){return void 0===e&&(e="group"),void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===o&&(o=0),void 0===t&&i!==!0&&(t=this.targetGroup),this.targetGroup=null,new Phaser.Group(this.game,t,e,i,n,o)},e.prototype.physicsGroup=function(t,e,i,n){return void 0===t&&(t=0),void 0===i&&(i="group"),void 0===n&&(n=!1),void 0===e&&(e=this.targetGroup),this.targetGroup=null,new Phaser.Group(this.game,e,i,n,!0,t)},e.prototype.spriteBatch=function(t,e,i){return void 0===e&&(e="spriteBatch"),void 0===i&&(i=!1),void 0===t&&(t=this.targetGroup),this.targetGroup=null,new Phaser.SpriteBatch(this.game,t,e,i)},e.prototype.tileSprite=function(t,e,i,n,o,a,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=this.targetGroup),this.targetGroup=null,r.add(new Phaser.TileSprite(this.game,t,e,i,n,o,a))},e.prototype.rope=function(t,e,i,n,o,a){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===a&&(a=this.targetGroup),this.targetGroup=null,a.add(new Phaser.Rope(this.game,t,e,i,n,o))},e.prototype.text=function(t,e,i,n,o){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=""),void 0===o&&(o=this.targetGroup),this.targetGroup=null,o.add(new Phaser.Text(this.game,t,e,i,n))},e.prototype.button=function(t,e,i,n,o,a,r,s,h,u){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===u&&(u=this.targetGroup),this.targetGroup=null,u.add(new Phaser.Button(this.game,t,e,i,n,o,a,r,s,h))},e.prototype.graphics=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=this.world),i.add(new Phaser.Graphics(this.game,t,e))},e.prototype.bitmapText=function(t,e,i,n,o,a){return void 0===n&&(n=""),void 0===o&&(o=32),void 0===a&&(a=this.targetGroup),this.targetGroup=null,a.add(new Phaser.BitmapText(this.game,t,e,i,n,o))},e.prototype.dSprite=function(t,e,i,n,a,r,s){return void 0===s&&(s=this.targetGroup),this.targetGroup=null,s.add(new o.Sprite(t,e,i,n,a,r))},e.prototype.dGroup=function(t,e,i,n,a,r,s,h){return void 0===h&&n!==!0?(h=this.targetGroup,this.targetGroup=null,h.add(new o.Group(t,e,i,n,a,r,s))):new o.Group(t,e,i,n,a,r,s)},e.prototype.dText=function(t,e,i,n,a,r,s,h,u,l,c,d){return void 0===d&&(d=this.targetGroup),this.targetGroup=null,d.add(new o.Text(t,e,i,n,a,r,s,h,u,l,c))},e.prototype.spine=function(t,e,i,n,a,r,s,h,u,l){return void 0===t&&(t=""),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===a&&(a=0),void 0===r&&(r="default"),void 0===s&&(s=""),void 0===h&&(h=0),void 0===u&&(u=0),void 0===l&&(l=this.targetGroup),this.targetGroup=null,l.add(new o.Spine(t,e,i,n,a,r,s,h,u))},e.prototype.setDefaultLayer=function(t){console.log("CAUTION: Changing the default layer will change the target group for .add"),this._defaultLayer=t},Object.defineProperty(e.prototype,"defaultLayer",{get:function(){return this._defaultLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetGroup",{get:function(){return this._targetGroup||this._defaultLayer},set:function(t){this._targetGroup=t},enumerable:!0,configurable:!0}),e}(Phaser.GameObjectFactory),t("GameObjectFactory",l),c=function(){function t(){this._defaultInterval=20,this.game=i.Application.getInstance().game}return t.prototype._executeMethod=function(t,e,i,n){var o=t.shift();"undefined"!=typeof o&&"undefined"!=typeof e&&e&&o.call(e),0===t.length&&i&&n&&i.call(n)},t.prototype.run=function(t,e,i,n,o){if("undefined"==typeof e)throw new Error("context must be provided for the sequence methods");if("undefined"==typeof i&&(i=this._defaultInterval),0===t.length&&"undefined"!=typeof n&&"undefined"!=typeof o)return void n.call(o);if(0!==i)this.game.time.events.repeat(i,t.length,this._executeMethod,this,t,e,"undefined"==typeof n?null:n,"undefined"==typeof o?null:o);else for(;t.length>0;)this._executeMethod(t,e,"undefined"==typeof n?null:n,"undefined"==typeof o?null:o)},t}(),t("SequenceManager",c),d=function(t){function e(){t.call(this),this._audio=[],this._mediator=null}return __extends(e,t),e.prototype.init=function(){},e.prototype.preload=function(){this.preloadID&&this.game.asset.loadAssets(this.preloadID)},e.prototype.create=function(){return this.game.asset.allSoundsDecoded()?(this.buildInterface(),this.afterBuildInterface(),void this.startBuild()):void this.game.asset.onLoadCompleteAndAudioDecoded.addOnce(this.create,this)},e.prototype.shutdown=function(e,i){void 0===e&&(e=!0),void 0===i&&(i=!0),e&&this.removeMediator(),i&&this.removeAudio(),t.prototype.shutdown.call(this)},e.prototype.listBuildSequence=function(){return[]},e.prototype.buildInterface=function(){},e.prototype.afterBuildInterface=function(){},e.prototype.startBuild=function(){this.game.sequence.run(this.listBuildSequence(),this,this.buildInterval,this.preAfterBuild,this)},e.prototype.preAfterBuild=function(){"undefined"!=typeof this.game.transition&&this.game.transition.canTransitionOut()?this.game.transition.canTransitionOut()&&(this.game.transition.onTransitionOutComplete.addOnce(this.afterBuild,this),this.game.transition.transitionOut()):this.afterBuild()},e.prototype.afterBuild=function(){},e.prototype.addAudio=function(t){return this._audio||(this._audio=[]),this._audio.push(t),t},e.prototype.removeAudio=function(){var t;if(this._audio)for(;this._audio.length>0;)t=this._audio.pop(),"undefined"!=typeof t&&null!=t&&"undefined"!=typeof t.stop&&("undefined"!=typeof t.onStop&&t.onStop.removeAll(),t.stop())},e.prototype.removeMediator=function(){this._mediator&&(this._mediator.destroy(),this._mediator=null)},Object.defineProperty(e.prototype,"preloadID",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buildInterval",{get:function(){return 10},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"add",{get:function(){return this.game.addToGame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"app",{get:function(){return i.Application.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"game",{get:function(){return this.app.game},enumerable:!0,configurable:!0}),e}(Phaser.State),t("State",d),p=function(){function t(){this.game=i.Application.getInstance().game,this._init()}return t.prototype._init=function(){this._localStorageAvailable=this._getIsLocalStorageAvailable(),console.log("local storage available",this._localStorageAvailable)},t.prototype._getIsLocalStorageAvailable=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}},t.prototype._getString=function(t){if("string"==typeof t)return t;var e;try{e=JSON.stringify(t)}catch(i){return console.log("Could not convert"+t+" to json"),null}return e},t.prototype.getFromLocalStorage=function(t,e){void 0===e&&(e=!0);var i=localStorage.getItem(t);return"undefined"==typeof i?(console.log("no data saved with the key",t),null):(e!==!1&&(i=JSON.parse(i)),i)},t.prototype.saveToLocalStorage=function(t,e){if(!this._localStorageAvailable)return console.log("no local storage"),!1;try{localStorage.setItem(t,this._getString(e))}catch(i){console.log("your data could not be saved")}},t.prototype.clearFromLocalStorage=function(t){if(!this._localStorageAvailable)return console.log("no local storage"),!1;try{localStorage.removeItem(t)}catch(e){}},t}(),t("StorageManager",p),f=function(){function t(){this.onTransitionOutComplete=new Phaser.Signal,this.onTransitionInComplete=new Phaser.Signal,this._transition=null,this._transitions={},this._exceptions={},this._fromState=null,this._toState=null,this.game=i.Application.getInstance().game}return t.prototype._add=function(t,e,i,n){this._transitions[t]={outHandler:e,preloadHandler:i,inHandler:n}},t.prototype._getTransition=function(t,e){var i=this._transitions[t+"/"+e];return"undefined"==typeof i&&(i=this._transitions.all),"undefined"==typeof i?null:i},t.prototype._transitionInComplete=function(){return this._transition=this._getTransition(this._fromState,this._toState),this._transition?("function"==typeof this._transition.preloadHandler.loadStart&&this.game.asset.onLoadStart.addOnce(this._transition.preloadHandler.loadStart,this._transition.preloadHandler),"function"==typeof this._transition.preloadHandler.loadProgress&&this.game.asset.onFileComplete.add(this._transition.preloadHandler.loadProgress,this._transition.preloadHandler),this.game.asset.onLoadCompleteAndAudioDecoded.addOnce(this._preloadComplete,this),this.onTransitionInComplete.dispatch(),void this.game.changeState(this._toState)):!1},t.prototype._transitionOutComplete=function(){this._transition=null,this.onTransitionOutComplete.dispatch()},t.prototype._preloadComplete=function(){return this._transition=this._getTransition(this._fromState,this._toState),this._transition?(this.game.asset.onFileComplete.remove(this._transition.preloadHandler.loadProgress,this._transition.preloadHandler),void("function"==typeof this._transition.preloadHandler.loadComplete&&this._transition.preloadHandler.loadComplete())):!1},t.prototype._clearTransition=function(){this._transition.outHandler.transitionInComplete.remove(this._transitionOutComplete,this),this._transition.inHandler.transitionOutComplete.remove(this._transitionInComplete,this),this.game.asset.onLoadCompleteAndAudioDecoded.remove(this._preloadComplete,this),this.game.asset.onLoadStart.remove(this._transition.preloadHandler.loadStart,this._transition.preloadHandler),this.game.asset.onFileComplete.remove(this._transition.preloadHandler.loadProgress,this._transition.preloadHandler),this._transition=null},t.prototype.add=function(t,e,i,n,o){var a;return arguments.length<5?"all"===t?(a=[].slice.call(arguments,1),2===arguments.length?this._add("all",a[0],a[0],a[0]):this._add("all",a[0],a[1],a[2])):(a=[].slice.call(arguments,2),this._add(t+"/"+e,a[0],a[0],a[0])):this._add(t+"/"+e,i,n,o)},t.prototype.addAll=function(t){return this._add("all",t,t,t)},t.prototype.addException=function(t){this._exceptions[t]=!0},t.prototype.remove=function(t,e){1===arguments.length?(this._transitions[t]=null,delete this._transitions[t]):(this._transitions[t+"/"+e]=null,delete this._transitions[t+"/"+e])},t.prototype.to=function(t){this._transition&&this._clearTransition(),this._exceptions[t]||(this._fromState=this.game.state.current,this._toState=t,this._transition=this._getTransition(this._fromState,this._toState),this._transition||(console.log("no transition found for:",this.game.state.current+" to "+t),this.game.changeState(this._toState)),this.transitionIn())},t.prototype.transitionIn=function(){this._transition&&"function"==typeof this._transition.outHandler.transitionIn&&(this._transition.outHandler.transitionInComplete.addOnce(this._transitionInComplete,this),this._transition.outHandler.transitionIn())},t.prototype.canTransitionOut=function(){return!this._exceptions[this.game.state.current]&&this._transition&&this._transition.inHandler&&"function"==typeof this._transition.inHandler.transitionOut},t.prototype.transitionOut=function(){this._transition.inHandler.transitionOutComplete.addOnce(this._transitionOutComplete,this),this._transition.inHandler.transitionOut()},t}(),t("TransitionManager",f)}}}),System.register("dijon/application",["dijon/core","dijon/mvc"],function(t,e){"use strict";var i,n,o;e&&e.id;return{setters:[function(t){i=t},function(t){n=t}],execute:function(){o=function(){function t(){var e=this;if(this._mediator=null,this._models={},this._mediators={},this._observerMap={},
t.instance)throw Error(t.SINGLETON_MSG);t.instance=this,window.addEventListener("hashchange",function(){t._getHashQuery(),e.windowHashChange()},!1),this.createGame(),this.startGame()}return t.prototype.windowHashChange=function(){},t.prototype.createGame=function(){this.game=new i.Game({width:800,height:600,parent:"game-container",renderer:Phaser.AUTO,transparent:!1})},t.prototype.startGame=function(){},t.prototype.addPlugins=function(){this.game.addPlugins()},t.prototype.registerModel=function(t){if(this._models[t.name])throw new Error('Application:: a model with the name "'+t.name+'" already exists.');return this._models[t.name]=t,t.onRegister(),t},t.prototype.retrieveModel=function(t){return this._models[t]||null},t.prototype.removeModel=function(t){var e=t.name,i=this._models[e];i&&(i.onRemoved(),delete this._models[e])},t.prototype.registerMediator=function(t){if(this._mediators[t.name])throw new Error('Application:: a mediator with the name "'+t.name+'" already exists.');this._mediators[t.name]=t,this.registerObserver(t),t.onRegister()},t.prototype.retrieveMediator=function(t){return this._mediators[t]||null},t.prototype.removeMediator=function(t){var e=this,i=t.name,n=this._mediators[i];n&&(n.listNotificationInterests().forEach(function(t){e.removeObserver(t,n)}),n.onRemoved(),delete this._mediators[i])},t.prototype.registerObserver=function(t){var e=this;t.listNotificationInterests().forEach(function(i){void 0===e._observerMap[i]&&(e._observerMap[i]=[]),e._observerMap[i].push(t)})},t.prototype.removeObserver=function(t,e){var i=null,n=null,o=0;for(i=this._observerMap[t],o=i.length;o--;)if(n=i[o],n===e){i.splice(o,1);break}0==i.length&&delete this._observerMap[t]},t.prototype.sendNotification=function(t,e){var i=new n.Notification(t,e);this._notifyObservers(i),i.destroy(),i=null},t.prototype._notifyObservers=function(t){var e=null,i=t.getName(),n=this._observerMap[i];n&&(e=n.slice(0),e.forEach(function(e){e.handleNotification(t)}))},t._getHashQuery=function(){t._hashQuery={},window.location.hash&&void 0!==window.location.hash||(window.location.hash="");var e=window.location.hash.substr(1,window.location.hash.length),i=e.split("&");i.forEach(function(e){var i=e.split("=");t._hashQuery[i[0]]=/^\d+$/.test(i[1])?parseInt(i[1]):i[1]})},t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.queryVar=function(e){return void 0===t._hashQuery&&t._getHashQuery(),t._hashQuery[e]||null},t.instance=null,t.SINGLETON_MSG="Application singleton already constructed!",t}(),t("Application",o)}}});